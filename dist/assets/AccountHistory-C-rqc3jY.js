import{r as e,j as t}from"./react-vendor-0Am1niUb.js";import{s as a,S as r}from"./index-BonT0QVc.js";import"./supabase-BsxaddrC.js";import"./vendor-DtN75V_I.js";const s=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],i=({onNavigate:i})=>{const[o,n]=e.useState(null),[d,c]=e.useState([]),[l,u]=e.useState(!0);e.useEffect(()=>{g()},[]);const g=async()=>{u(!0);try{const{data:{user:e}}=await a.auth.getUser();if(!e)return;const{data:t}=await a.from("profiles").select("code, phone").eq("id",e.id).single();n({code:t?.code||"N/A",phone:t?.phone||e.phone||e.user_metadata?.phone||"N/A"});const[r,i,o,d,l,u]=await Promise.all([a.from("depositos_clientes").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}),a.from("depositos_usdt").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}),a.from("retirada_clientes").select("*").eq("user_id",e.id).order("data_de_criacao",{ascending:!1}),a.from("historico_compras").select("*").eq("user_id",e.id).order("data_compra",{ascending:!1}),a.from("bonus_transacoes").select("*").eq("user_id",e.id).order("data_recebimento",{ascending:!1}),a.from("transacoes_p2p").select("*").or(`sender_id.eq.${e.id},receiver_id.eq.${e.id}`).order("created_at",{ascending:!1})]),g=[];r.data?.forEach(e=>{const t=new Date(e.created_at);g.push({id:`dep-${e.id}`,title:"Recarga de Saldo",subtitle:`${e.nome_do_banco||"Transferência"} - ${e.estado_de_pagamento||"pendente"}`,amount:Number(e.valor_deposito||0),time:t.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${t.getDate()} de ${s[t.getMonth()]}`,monthIndex:t.getMonth(),year:t.getFullYear(),type:"incoming",category:"Recarga",status:e.estado_de_pagamento})}),i.data?.forEach(e=>{const t=new Date(e.created_at);g.push({id:`usdt-${e.id}`,title:"Recarga Cripto",subtitle:`Rede USDT - ${e.status||"pendente"}`,amount:Number(e.amount_kz||0),time:t.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${t.getDate()} de ${s[t.getMonth()]}`,monthIndex:t.getMonth(),year:t.getFullYear(),type:"incoming",category:"Recarga",status:e.status})}),o.data?.forEach(e=>{const t=e.data_de_criacao?new Date(e.data_de_criacao):new Date;g.push({id:`wit-${e.id}`,title:"Resgate de Recompensa",subtitle:`${e.nome_do_banco||"Banco"} - ${e.estado_da_retirada||"revisão"}`,amount:-Number(e.valor_solicitado),time:t.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${t.getDate()} de ${s[t.getMonth()]}`,monthIndex:t.getMonth(),year:t.getFullYear(),type:"outgoing",category:"Resgate",status:e.estado_da_retirada})}),d.data?.forEach(e=>{const t=new Date(e.data_compra);g.push({id:`pur-${e.id}`,title:e.nome_produto||"Pedido de Produto",subtitle:"Marketplace BP",amount:-Number(e.preco||0),time:t.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${t.getDate()} de ${s[t.getMonth()]}`,monthIndex:t.getMonth(),year:t.getFullYear(),type:"outgoing",category:"Pedidos"})}),l.data?.forEach(e=>{const t=new Date(e.data_recebimento);g.push({id:`bon-${e.id}`,title:"Incentivo Recebido",subtitle:e.origem_bonus||"Evento Especial",amount:Number(e.valor_recebido||0),time:t.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${t.getDate()} de ${s[t.getMonth()]}`,monthIndex:t.getMonth(),year:t.getFullYear(),type:"incoming",category:"Promoção"})}),u.data?.forEach(t=>{const a=new Date(t.created_at),r=t.sender_id===e.id;g.push({id:`p2p-${t.id}`,title:r?"Transferência Enviada":"Transferência Recebida",subtitle:r?"Para outro usuário":"De outro usuário",amount:r?-Number(t.amount):Number(t.amount),time:a.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"}),dateLabel:`${a.getDate()} de ${s[a.getMonth()]}`,monthIndex:a.getMonth(),year:a.getFullYear(),type:r?"outgoing":"incoming",category:"Misto"})}),c(g.sort((e,t)=>{if(t.year!==e.year)return t.year-e.year;if(t.monthIndex!==e.monthIndex)return t.monthIndex-e.monthIndex;const a=parseInt(e.dateLabel.split(" ")[0]);return parseInt(t.dateLabel.split(" ")[0])-a}))}catch(e){}finally{u(!1)}},m=d.reduce((e,t)=>{const a=t.dateLabel;return e[a]||(e[a]=[]),e[a].push(t),e},{}),p=(e,t)=>{if(!e)return"";const a=e.toLowerCase();if("Resgate"===t){if("revisão"===a||"pendente"===a)return"text-blue-600 bg-blue-100/50";if("aprovado"===a||"concluido"===a||"completado"===a||"processado"===a)return"text-green-700 bg-green-100/50";if("rejeitada"===a||"rejeitado"===a||"cancelado"===a)return"text-orange-600 bg-orange-100/50"}if("Recarga"===t){if("pendente"===a||"revisão"===a||"processando..."===a)return"text-blue-600 bg-blue-100/50";if("sucedido"===a||"completo"===a||"concluido"===a||"sucesso"===a)return"text-green-700 bg-green-100/50";if("falha"===a||"falhou"===a||"rejeitado"===a||"rejectado"===a)return"text-red-600 bg-red-100/50"}switch(a){case"completo":case"aprovado":case"sucesso":case"sucedido":return"text-green-700 bg-green-50";case"pendente":case"revisão":return"text-blue-600 bg-blue-50";case"falha":case"falhou":case"rejeitado":case"rejeitada":return"text-red-600 bg-red-50";default:return"text-gray-500 bg-gray-100/50"}};return t.jsxs("div",{className:"bg-white font-sans text-black antialiased min-h-screen flex flex-col",children:[t.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsx("button",{onClick:()=>i("profile"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),t.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Atividade"}),t.jsx("div",{className:"w-11"})]})}),t.jsx("main",{className:"flex-1 overflow-y-auto no-scrollbar pb-24 touch-pan-y pt-2",children:l?t.jsx("div",{className:"flex items-center justify-center py-20",children:t.jsx(r,{size:"w-8 h-8"})}):Object.keys(m).length>0?Object.keys(m).map(e=>t.jsxs("div",{className:"mb-4",children:[t.jsxs("p",{className:"text-gray-400 text-[11px] font-bold uppercase tracking-[0.1em] pb-3 pt-4 px-6 flex items-center gap-2",children:[t.jsx("span",{className:"size-1.5 bg-[#00C853] rounded-full"}),e]}),t.jsx("div",{className:"flex flex-col gap-2 px-4",children:m[e].map(e=>t.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-[24px] border border-transparent transition-all active:scale-[0.98]",children:[t.jsx("div",{className:"relative flex items-center justify-center size-12 rounded-full shrink-0 "+("Recarga"===e.category?"bg-[#00C853]/10 text-[#00C853]":"Resgate"===e.category?"bg-red-500/10 text-red-500":"Segurança"===e.category?"bg-blue-500/10 text-blue-400":"Promoção"===e.category?"bg-purple-500/10 text-purple-600":"bg-gray-200 text-gray-600"),children:t.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"Recarga"===e.category?"add_card":"Resgate"===e.category?"payments":"Segurança"===e.category?"security":"Promoção"===e.category?"redeem":"shopping_bag"})}),t.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[t.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[t.jsx("p",{className:"text-[#111] text-[15px] font-bold truncate leading-tight",children:e.title}),t.jsxs("p",{className:"text-[15px] font-black "+("Resgate"===e.category?"text-red-500":e.amount>0?"text-[#00C853]":"text-black"),children:["Resgate"===e.category||e.amount<0?"-":"+"," ",Math.abs(e.amount).toLocaleString()," KZs"]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[t.jsx("p",{className:"text-gray-400 text-[11px] uppercase font-bold tracking-wider opacity-80 truncate",children:e.subtitle}),e.status&&t.jsx("span",{className:`px-1.5 py-0.5 rounded text-[8px] font-black uppercase tracking-tighter shrink-0 ${p(e.status,e.category)}`,children:e.status})]}),t.jsx("p",{className:"text-gray-400 text-[11px] font-medium whitespace-nowrap",children:e.time})]})]})]},e.id))})]},e)):t.jsxs("div",{className:"flex flex-col items-center justify-center py-32 px-10 text-center opacity-30",children:[t.jsx("div",{className:"size-20 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:t.jsx("span",{className:"material-symbols-outlined text-gray-400",children:"folder_off"})}),t.jsx("p",{className:"font-black uppercase tracking-[0.2em] text-[12px] leading-relaxed text-gray-400",children:"Nenhum registro encontrado"})]})})]})};export{i as default};
