import{r as e,j as t}from"./react-vendor-C8-TlGsU.js";import{u as a,s,S as n}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const l=({onNavigate:l,showToast:r})=>{const{withLoading:o}=a(),[i,c]=e.useState(""),[d,x]=e.useState(""),[m,p]=e.useState(""),[u,h]=e.useState(!1),[b,f]=e.useState(null),[j,g]=e.useState("create"),[v,N]=e.useState(!1),[y,w]=e.useState(null),B={"Banco BAI":"0040","Banco BFA":"0006","Banco BIC":"0051","Banco Atlântico":"0055","Banco Sol":"0044","Banco BNI":"0009"};e.useEffect(()=>{if(y){const e=setTimeout(()=>w(null),3e3);return()=>clearTimeout(e)}},[y]),e.useEffect(()=>{C()},[]);const C=async()=>{h(!0);try{const{data:e}=await s.rpc("get_my_bank_accounts");e&&e.length>0&&(f(e[0]),g("view"))}catch(e){}finally{h(!1)}};return t.jsxs("div",{className:"font-sans antialiased bg-white text-[#0F1111] min-h-screen flex flex-col selection:bg-amber-100",children:[t.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsx("button",{onClick:()=>l("profile"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),t.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"view"===j?"Dados Bancários":"edit"===j?"Editar Conta":"Nova Conta"}),t.jsx("div",{className:"w-11"})]})}),t.jsx("main",{className:"flex-1 flex flex-col w-full max-w-lg mx-auto px-5 pt-6 pb-10",children:"view"===j?t.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 space-y-8 animate-in fade-in zoom-in-95 duration-500",children:[t.jsx("div",{className:"size-20 bg-green-50 rounded-full flex items-center justify-center mb-2 border border-green-100",children:t.jsx("span",{className:"material-symbols-outlined text-green-600 text-4xl",children:"verified_user"})}),t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("h2",{className:"text-xl font-bold text-[#0F1111]",children:"Conta Vinculada"}),t.jsx("p",{className:"text-[#565959] text-sm",children:"Seus recebimentos serão enviados para:"})]}),t.jsx("div",{className:"w-full bg-gray-50 border border-gray-100 rounded-xl p-5 space-y-5",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center border-b border-gray-100 pb-3",children:[t.jsx("span",{className:"text-[13px] font-bold text-[#565959]",children:"Banco"}),t.jsx("span",{className:"text-[14px] font-bold text-[#0F1111]",children:b?.nome_banco})]}),t.jsxs("div",{className:"flex justify-between items-center border-b border-gray-100 pb-3",children:[t.jsx("span",{className:"text-[13px] font-bold text-[#565959]",children:"Titular"}),t.jsx("span",{className:"text-[14px] font-bold text-[#0F1111]",children:b?.nome_completo})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-[11px] font-bold text-[#565959] uppercase tracking-wider mb-1 block",children:"IBAN"}),t.jsx("p",{className:"text-[15px] font-mono font-medium text-[#0F1111] bg-gray-50 p-3 rounded-lg border border-gray-200 break-all",children:b?.iban})]})]})}),t.jsxs("div",{className:"flex flex-col w-full gap-3 pt-4",children:[t.jsx("button",{onClick:()=>{b&&(c(b.nome_banco),x(b.nome_completo),p(b.iban),g("edit"))},className:"w-full h-[45px] bg-gray-50 border border-gray-100 text-[#0F1111] text-[14px] font-medium rounded-lg active:scale-[0.98] transition-all hover:bg-white",children:"Editar"}),t.jsx("button",{onClick:()=>{N(!0)},className:"w-full h-[45px] text-[#CC0C39] text-[14px] font-medium rounded-lg hover:bg-red-50 transition-all font-bold",children:"Remover"})]})]}):t.jsxs("div",{className:"flex-1 flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-[18px] font-bold text-[#0F1111] mb-1",children:"Adicionar Conta Bancária"}),t.jsx("p",{className:"text-[#565959] text-[13px]",children:"Certifique-se que o titular da conta corresponde ao seu BI."})]}),t.jsxs("div",{className:"space-y-3 flex-1",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-[13px] font-bold text-[#0F1111]",children:"Banco Destinatário"}),t.jsxs("div",{className:"bg-gray-50 rounded-[12px] h-[50px] flex items-center px-4 gap-3 relative border border-transparent focus-within:border-[#00C853] transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"account_balance"}),t.jsxs("select",{value:i,onChange:e=>c(e.target.value),className:"bg-transparent flex-1 h-full outline-none text-[#0F1111] font-medium appearance-none cursor-pointer text-[14px]",children:[t.jsx("option",{value:"",children:"Selecione o banco..."}),t.jsx("option",{value:"Banco BAI",children:"Banco BAI"}),t.jsx("option",{value:"Banco BFA",children:"Banco BFA"}),t.jsx("option",{value:"Banco BIC",children:"Banco BIC"}),t.jsx("option",{value:"Banco Atlântico",children:"Banco Atlântico"}),t.jsx("option",{value:"Banco Sol",children:"Banco Sol"}),t.jsx("option",{value:"Banco BNI",children:"Banco BNI"})]}),t.jsx("span",{className:"material-symbols-outlined text-gray-400 text-[20px]",children:"expand_more"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-[13px] font-bold text-[#0F1111]",children:"Nome do Titular"}),t.jsxs("div",{className:"bg-gray-50 rounded-[12px] h-[50px] flex items-center px-4 gap-3 relative border border-transparent focus-within:border-[#00C853] transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"person"}),t.jsx("input",{value:d,onChange:e=>x(e.target.value),className:"bg-transparent flex-1 h-full outline-none text-[#0F1111] font-medium placeholder:text-gray-400 text-[14px]",placeholder:"Ex: João Manuel Silva",type:"text"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-[13px] font-bold text-[#0F1111]",children:"IBAN (21 Dígitos)"}),t.jsxs("div",{className:"bg-gray-50 rounded-[12px] h-[50px] flex items-center px-4 gap-3 relative border border-transparent focus-within:border-[#00C853] transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"pin"}),t.jsx("input",{value:m,onChange:e=>{let t=e.target.value.replace(/\D/g,"");p(t)},maxLength:21,className:"bg-transparent flex-1 h-full outline-none text-[#0F1111] font-mono placeholder:text-gray-400 text-[14px]",placeholder:"Digite os 21 números do seu IBAN",type:"text"})]})]})]}),t.jsxs("div",{className:"mt-8 space-y-3",children:["edit"===j&&t.jsx("button",{onClick:()=>g("view"),className:"w-full h-10 text-[#007185] text-[13px] font-medium hover:underline transition-colors",children:"Cancelar"}),t.jsx("button",{onClick:async()=>{try{w(null);let e=m.replace(/\D/g,"");if(21!==e.length)return void w("O IBAN deve ter exatamente 21 dígitos.");let t=`AO06${e}`;if(i&&B[i]){const t=B[i];if(e.substring(0,4)!==t)return void w(`Este IBAN não corresponde ao ${i}. Verifique se selecionou o banco correto.`)}await o(async()=>{const{data:{user:e}}=await s.auth.getUser();if(!e)throw new Error("Sessão expirada. Acesse novamente.");const a={p_bank_name:i,p_holder_name:d,p_iban:t},{error:n}=await s.rpc("edit"===j?"update_bank_account":"add_bank_account",a);if(n)throw n;r?.("Bem sucedido","success"),await C(),setTimeout(()=>l("profile"),1200)},"Salvando dados bancários...")}catch(e){e.message&&!e.message.includes("loading")&&w(e.message)}},disabled:u,className:"w-full h-[45px] bg-primary hover:bg-primary-hover border border-[#00C853] rounded-[8px] flex items-center justify-center font-bold text-white text-[15px] active:scale-[0.99] transition-all",children:u?t.jsx(n,{size:"w-5 h-5",color:"text-black"}):"Salvar"}),t.jsxs("div",{className:"flex items-center justify-center gap-1.5 pt-2 opacity-60",children:[t.jsx("span",{className:"material-symbols-outlined text-[16px] text-[#565959]",children:"lock"}),t.jsx("p",{className:"text-[11px] text-[#565959]",children:"Ambiente seguro BP"})]})]})]})}),y&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none animate-in fade-in duration-200",children:t.jsx("div",{className:"bg-red-500/90 text-white px-6 py-3 rounded-xl max-w-sm mx-4 text-center text-sm font-medium pointer-events-auto",children:y})}),v&&t.jsx("div",{className:"fixed inset-0 z-[9999] bg-white/60 backdrop-blur-md flex items-end sm:items-center justify-center p-4",children:t.jsx("div",{className:"bg-white w-full max-w-sm rounded-[32px] shadow-2xl border border-gray-50 overflow-hidden animate-in fade-in slide-in-from-bottom-8 duration-300",children:t.jsxs("div",{className:"p-8 text-center space-y-6",children:[t.jsx("div",{className:"size-16 bg-red-50 rounded-full flex items-center justify-center mx-auto border border-red-100",children:t.jsx("span",{className:"material-symbols-outlined text-red-500 text-3xl",children:"delete_forever"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-xl font-bold text-[#0F1111]",children:"Apagar Conta?"}),t.jsx("p",{className:"text-[#565959] text-sm",children:"Esta ação não pode ser desfeita. Você precisará vincular novamente para realizar saques."})]}),t.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[t.jsx("button",{onClick:async()=>{N(!1),h(!0);try{const{error:e}=await s.from("bancos_clientes").delete().eq("user_id",b.user_id);if(e)throw e;r?.("Apagada sucesso!","success"),f(null),c(""),x(""),p(""),g("create")}catch(e){r?.("Erro ao deletar: "+(e.message||"Erro desconhecido"),"error")}finally{h(!1)}},className:"w-full h-[45px] bg-red-500 text-white font-black text-[15px] rounded-2xl shadow-lg shadow-red-500/20 active:scale-95 transition-all",children:"Confirmar Exclusão"}),t.jsx("button",{onClick:()=>N(!1),className:"w-full h-[45px] text-[#565959] font-bold text-[14px] hover:bg-gray-50 rounded-2xl transition-all",children:"Manter Conta"})]})]})})})]})};export{l as default};
