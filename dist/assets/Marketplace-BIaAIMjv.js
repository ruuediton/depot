import{r as e,j as s}from"./react-vendor-C8-TlGsU.js";import{u as t,S as a,s as r}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const l=({onNavigate:l,showToast:n,profile:i})=>{const[o,c]=e.useState(null),[d,x]=e.useState([]),{withLoading:m}=t(),[p,u]=e.useState(!1),[h,b]=e.useState(""),[f,g]=e.useState(!1),[j,N]=e.useState(!0),v=i?.balance||0,y=e.useMemo(()=>d.reduce((e,s)=>e+(Number(s.total_fundos_disponivel)||0),0),[d]),w=e.useMemo(()=>{if(!o||!h)return 0;const e=Number(h);if(isNaN(e))return 0;return e+e*(o.taxa_retorno/100)},[o,h]);e.useEffect(()=>{(async()=>{await k(!0),N(!1)})()},[]);const k=async(e=!1)=>{const s=async()=>{const{data:e,error:s}=await r.from("fundos").select("*").eq("estado",!0).order("data_disponivel",{ascending:!1});if(s)throw s;x(e||[])};e?await s():await m(s)};return j?s.jsx("div",{className:"flex justify-center items-center h-screen bg-white",children:s.jsx(a,{size:"w-10 h-10",color:"text-[#00C853]"})}):s.jsxs("div",{className:"bg-white min-h-screen font-sans text-[#0F1111] pb-20 selection:bg-amber-100 antialiased",children:[s.jsxs("header",{className:"header-gradient-mixture pb-24 pt-4 px-4",children:[s.jsxs("div",{className:"relative z-10 flex items-center justify-between mb-8",children:[s.jsx("button",{onClick:()=>l("home"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:s.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),s.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Market"}),s.jsx("button",{onClick:()=>l("historico-fundos"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:s.jsx("span",{className:"material-symbols-outlined text-white text-[24px]",children:"history"})})]}),s.jsxs("div",{className:"relative z-10 flex flex-col gap-1",children:[s.jsx("p",{className:"text-white/60 text-[11px] font-bold uppercase tracking-wider",children:"Estoque Global"}),s.jsxs("h1",{className:"text-white text-4xl font-black tabular-nums tracking-tighter",children:[s.jsx("span",{className:"text-white/80 text-xl mr-1",children:"KZs"}),y.toLocaleString("pt-AO")]})]})]}),s.jsx("div",{className:"px-5 -mt-8 mb-4 relative z-20",children:s.jsxs("div",{className:"bg-white border border-gray-100 p-5 rounded-2xl flex items-center justify-between shadow-xl",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"size-12 bg-green-50 rounded-xl flex items-center justify-center border border-green-100",children:s.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"wallet"})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[10px] text-gray-400 font-black uppercase tracking-widest",children:"Saldo Disponível"}),s.jsxs("div",{className:"flex items-baseline gap-1",children:[s.jsx("span",{className:"text-[#0F1111] font-black text-[18px]",children:v.toLocaleString("pt-AO",{minimumFractionDigits:2})}),s.jsx("span",{className:"text-[11px] font-bold text-gray-400",children:"KZs"})]})]})]}),s.jsx("div",{className:"h-8 w-px bg-gray-100"}),s.jsxs("button",{onClick:()=>l("historico-fundos"),className:"flex items-center gap-2 text-[#232F3E] hover:text-[#00C853] transition-colors",children:[s.jsxs("div",{className:"flex flex-col items-end",children:[s.jsx("span",{className:"text-[10px] text-gray-400 font-black uppercase tracking-wider",children:"Pedidos"}),s.jsx("span",{className:"text-[11px] font-bold",children:"Ver Tudo"})]}),s.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"chevron_right"})]})]})}),s.jsxs("div",{className:"px-5 pt-4 space-y-2",children:[s.jsx("h2",{className:"text-[18px] font-extrabold text-[#0F1111]",children:"Destaques do Dia"}),s.jsx("p",{className:"text-[12px] text-gray-500 font-medium",children:"Selecione um produto para garantir seus benefícios."})]}),s.jsx("section",{className:"overflow-x-auto snap-x snap-mandatory flex no-scrollbar mt-4 px-5 pb-8",children:s.jsx("div",{className:"flex gap-4",children:d.length>0?d.map(e=>{const t=Number(e.total_fundos_disponivel)<=0;return s.jsxs("div",{className:"snap-center flex-none w-[220px] flex flex-col bg-white border border-gray-200 rounded-2xl overflow-hidden",children:[s.jsxs("div",{className:"w-full aspect-video bg-cover bg-center relative",style:{backgroundImage:`url("${e.url_imagem}")`},children:[t&&s.jsx("div",{className:"absolute inset-0 bg-white/80 flex items-center justify-center",children:s.jsx("span",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-[10px] font-bold",children:"ESGOTADO"})}),s.jsxs("div",{className:"absolute bottom-2 right-2 bg-[#00C853] text-[#0F1111] px-2 py-1 rounded font-black text-[12px]",children:["+",e.taxa_retorno,"% Cashback"]})]}),s.jsxs("div",{className:"p-4 flex flex-col flex-1 space-y-3",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-[#0F1111] text-[15px] font-black leading-tight truncate",children:e.nome_fundo}),s.jsxs("p",{className:"text-gray-400 text-[10px] font-medium leading-tight mt-1",children:[e.duration_days," dias de promoção"]})]}),s.jsx("button",{onClick:()=>{c(e),b(""),g(!1)},disabled:t,className:"w-full h-11 rounded-lg font-bold text-[12px] transition-all active:scale-95 "+(t?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[#00C853] border border-[#00C853] text-white hover:bg-[#00C853]"),children:t?"Indisponível":"Adquirir Agora"})]})]},e.id_fundo)}):s.jsxs("div",{className:"w-[85vw] py-16 flex flex-col items-center justify-center text-gray-300 border-2 border-dashed border-gray-100 rounded-2xl",children:[s.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"cloud_off"}),s.jsx("p",{className:"font-bold text-[11px] uppercase",children:"Nenhum produto disponível"})]})})}),o&&s.jsx("section",{className:"px-5 pb-20 animate-in slide-in-from-bottom-10 duration-500",children:s.jsxs("div",{className:"bg-[#f3f3f3] rounded-3xl p-6 border border-gray-200 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"size-12 rounded-xl bg-[#0F1111] flex items-center justify-center text-[#00C853]",children:s.jsx("span",{className:"material-symbols-outlined text-2xl",children:"rocket_launch"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[17px] font-black text-[#0F1111]",children:o.nome_fundo}),s.jsx("p",{className:"text-green-600 text-[11px] font-bold",children:"Benefício Diário Garantido"})]})]}),s.jsx("button",{onClick:()=>c(null),className:"size-10 rounded-full hover:bg-white transition-colors text-gray-400",children:s.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 flex flex-col items-center",children:[s.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase",children:"Cashback"}),s.jsxs("span",{className:"text-[20px] font-black text-green-600",children:[o.taxa_retorno,"%"]})]}),s.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 flex flex-col items-center",children:[s.jsx("span",{className:"text-[9px] font-bold text-gray-400 uppercase",children:"Duração"}),s.jsxs("span",{className:"text-[20px] font-black text-[#0F1111]",children:[o.duration_days," ",s.jsx("span",{className:"text-[12px]",children:"Dias"})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"text-[12px] font-bold text-[#0F1111]",children:"Valor do Pedido (KZs)"}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 font-black text-xl text-gray-300",children:"KZs"}),s.jsx("input",{autoFocus:!0,type:"number",min:"100",placeholder:"0.00",className:"w-full h-[50px] bg-white border border-gray-200 focus:border-[#e77600] rounded-xl pl-12 pr-4 text-2xl font-black text-[#0F1111] outline-none transition-all",value:h,onChange:e=>b(e.target.value)})]}),s.jsxs("div",{className:"bg-white p-4 rounded-xl border border-dashed border-gray-300 flex justify-between items-center",children:[s.jsx("span",{className:"text-[11px] font-bold text-gray-400 uppercase",children:"Recompensa Estimada"}),s.jsxs("span",{className:"text-[18px] font-black text-green-600 tabular-nums",children:["KZs ",w.toLocaleString("pt-AO")]})]})]}),s.jsxs("label",{className:"flex items-center gap-3 p-4 bg-white rounded-xl border border-gray-100 cursor-pointer active:scale-[0.98] transition-all",children:[s.jsx("input",{type:"checkbox",className:"size-5 rounded border-gray-300 text-[#00C853] focus:ring-[#00C853]",checked:f,onChange:()=>g(!f)}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-[12px] font-bold text-[#0F1111]",children:"Recompra Automática"}),s.jsx("p",{className:"text-[10px] text-gray-400",children:"Ative para maximizar seus ganhos mensais."})]})]}),s.jsx("button",{onClick:async()=>{if(!o||!h)return;const e=Number(h);if(isNaN(e)||e<200)n&&n("Valor mínimo de alocação 200 KZs.","warning");else{u(!0);try{await m(async()=>{const{data:{user:s}}=await r.auth.getUser();if(!s)throw l("login"),new Error("Sessão expirada. Entre novamente.");if(e>Number(o.total_fundos_disponivel))throw new Error(`Estoque insuficiente! O valor disponível é de ${Number(o.total_fundos_disponivel).toLocaleString("pt-AO")} KZs.`);const{data:t,error:a}=await r.rpc("purchase_fund",{p_fund_id:o.id_fundo,p_amount:e,p_auto_reinvest:f});if(a)throw new Error("Operação não sucedida");if(t&&!t.success)throw new Error(t.message||"Não foi possível realizar a operação.");return t.message},"Operação realizada com sucesso!"),c(null),b(""),g(!1),k(!0)}catch(s){}finally{u(!1)}}},disabled:p||!h||Number(h)<=0,className:"w-full h-[45px] rounded-xl font-black text-[14px] uppercase transition-all flex items-center justify-center gap-3 "+(p||!h||Number(h)<=0?"bg-gray-200 text-gray-400":"bg-[#00C853] border border-[#00C853] text-white hover:bg-[#00C853] active:scale-[0.98]"),children:p?s.jsx(a,{size:"w-6 h-6",color:"text-[#0F1111]"}):"Confirmar Pedido"})]})}),!o&&s.jsx("section",{className:"px-5 mt-4",children:s.jsxs("div",{className:"bg-[#fdf8f3] border border-[#f3ebdf] p-8 rounded-3xl flex flex-col items-center text-center space-y-4",children:[s.jsx("div",{className:"size-14 rounded-full bg-white flex items-center justify-center border border-gray-100",children:s.jsx("span",{className:"material-symbols-outlined text-[#e47911] text-2xl",children:"verified_user"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[#0F1111] font-black text-[16px]",children:"Compra Segura"}),s.jsx("p",{className:"text-gray-500 text-[11px] max-w-[200px] font-medium leading-relaxed italic",children:"Suas transações são processadas em ambiente seguro protegido."})]})]})})]})};export{l as default};
