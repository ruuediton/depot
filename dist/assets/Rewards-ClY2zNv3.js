import{r as e,j as s}from"./react-vendor-C8-TlGsU.js";import{u as t,s as a,S as r}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const l=({onNavigate:l,showToast:i})=>{const{withLoading:n,showError:o}=t(),[d,c]=e.useState(!0),[x,m]=e.useState([]),[p,h]=e.useState(!1),[u,f]=e.useState(!1),[b,g]=e.useState(0);e.useEffect(()=>{j()},[]);const j=async()=>{c(!0);try{const{data:{user:e}}=await a.auth.getUser();if(!e)return void l("login");const{data:s,error:t}=await a.rpc("get_task_screen_data");if(t)throw t;s&&(m(s.purchases||[]),g(s.potential_income||0),h(s.has_collected_today||!1))}catch(e){}finally{c(!1)}};return s.jsx("div",{className:"bg-white font-sans text-[#0F1111] min-h-screen selection:bg-amber-100",children:s.jsxs("div",{className:"relative flex h-full min-h-screen w-full flex-col overflow-x-hidden max-w-md mx-auto bg-white",children:[s.jsx("div",{className:"flex flex-col items-center pt-8 pb-4",children:s.jsxs("div",{className:"flex items-center gap-2 bg-[#F0F2F2] border border-gray-200 px-5 py-2 rounded-full",children:[s.jsx("span",{className:"material-symbols-outlined text-[#007600] text-[18px]",children:"trending_up"}),s.jsxs("span",{className:"text-[13px] font-bold text-[#007600] uppercase tracking-wide",children:["Hoje: ",p?"+0,00":`+${b.toLocaleString()}`," Kz"]})]})}),s.jsxs("div",{className:"flex flex-col items-center justify-center py-10",children:[s.jsx("button",{onClick:async()=>{if(!u){f(!0);try{await n(async()=>{const{data:{user:e}}=await a.auth.getUser();if(!e)throw new Error("Sessão expirada.");const{data:s,error:t}=await a.rpc("collect_daily_income");if(t)throw new Error("Erro de comunicação. Tente novamente.");if(!s.success)throw new Error(s.message||"Erro ao coletar renda.");return h(!0),s.message},"Tarefa diária concluída!")}catch(e){o(e)}finally{f(!1)}}},disabled:p||u,className:"relative z-10 flex flex-col items-center justify-center w-32 h-32 rounded-full transition-all active:scale-95 group border-4 "+(p?"bg-gray-100 border-gray-200 text-[#565959]":"bg-[#00C853] border-[#00C853] text-[#0F1111] hover:bg-[#00C853]"),children:u?s.jsx(r,{className:"text-[#0F1111]",size:"w-8 h-8"}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"material-symbols-outlined text-[44px] mb-1",children:p?"verified":"power_settings_new"}),s.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tight text-center px-2",children:p?"Coletado":"Check-in"})]})}),s.jsx("p",{className:"mt-6 text-[12px] font-bold uppercase tracking-[0.2em] "+(p?"text-[#565959]":"text-[#007600] animate-pulse"),children:p?"RENDA COLETADA":"SISTEMA ONLINE"})]}),s.jsxs("div",{className:"mx-4 mb-8 p-3 rounded-lg bg-[#00C853] border border-[#00C853]/30 flex items-center gap-3 overflow-hidden",children:[s.jsx("span",{className:"material-symbols-outlined text-[#0F1111] text-[20px] shrink-0",children:"info"}),s.jsx("div",{className:"flex-1 overflow-hidden relative h-5",children:s.jsxs("div",{className:"absolute whitespace-nowrap animate-marquee flex items-center text-[13px] text-[#0F1111] font-medium",children:[s.jsx("span",{className:"mr-12",children:"• Realize seu check-in diariamente para receber seus ganhos."}),s.jsx("span",{className:"mr-12",children:"• Seus dispositivos ativos geram recompensas 24 horas por dia."})]})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 px-4 mb-10",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:"material-symbols-outlined text-[20px] text-[#565959]",children:"calendar_month"}),s.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-[#565959]",children:"Projeção Semanal"})]}),s.jsxs("p",{className:"text-[18px] font-bold text-[#0F1111]",children:["Kz ",(7*b).toLocaleString()]})]}),s.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:"material-symbols-outlined text-[20px] text-[#565959]",children:"inventory"}),s.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-[#565959]",children:"Ativos Totais"})]}),s.jsxs("p",{className:"text-[18px] font-bold text-[#0F1111]",children:[x.filter(e=>"confirmado"===e.status).length," Unidades"]})]})]}),s.jsxs("div",{className:"flex flex-col px-4 pb-32",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-[16px] font-bold text-[#0F1111]",children:"Equipamentos Ativos"}),s.jsx("button",{onClick:()=>l("purchase-history"),className:"text-[12px] font-bold text-[#007185] hover:underline",children:"Detalhes"})]}),d?s.jsx("div",{className:"flex flex-col items-center justify-center py-40 gap-4",children:s.jsx(r,{size:"w-10 h-10",color:"text-[#00C853]"})}):0===x.length?s.jsxs("div",{className:"bg-gray-50 p-8 rounded-xl border border-dashed border-gray-200 text-center",children:[s.jsx("p",{className:"text-[#565959] text-[13px] font-medium leading-relaxed mb-6",children:"Você ainda não possui eletrônicos ativos. Visite a loja para começar."}),s.jsx("button",{onClick:()=>l("shop"),className:"w-full h-11 bg-[#00C853] hover:bg-[#00C853] text-white text-[13px] font-bold uppercase rounded-full transition-all border border-[#00C853]",children:"Loja"})]}):s.jsx("div",{className:"flex flex-col divide-y divide-gray-100 border-t border-gray-100",children:x.map(e=>s.jsxs("div",{className:"flex items-center gap-4 py-4 active:bg-gray-50 transition-colors",children:[s.jsxs("div",{className:"relative w-16 h-16 shrink-0 rounded-lg bg-gray-50 flex items-center justify-center p-2 border border-gray-100",children:[e.url_produtos?s.jsx("img",{loading:"lazy",decoding:"async",alt:e.nome,className:"object-contain w-full h-full",src:e.url_produtos}):s.jsx("span",{className:"material-symbols-outlined text-[#565959] text-[32px]",children:"devices"}),s.jsx("div",{className:`absolute top-0 right-0 w-2.5 h-2.5 ${"confirmado"===e.status?"bg-[#007600]":"bg-amber-500"} rounded-full border-2 border-white -mr-1 -mt-1`})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"text-[14px] font-medium text-[#0F1111] truncate",children:e.nome}),s.jsxs("div",{className:"flex items-center gap-2 mt-1.5 font-bold",children:[s.jsx("div",{className:"flex-1 h-1 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-[#00C853] rounded-full "+("confirmado"===e.status?"w-full":"w-0")})}),s.jsx("span",{className:"text-[10px] uppercase tracking-tighter "+("confirmado"===e.status?"text-[#007600]":"text-amber-600"),children:"confirmado"===e.status?"Gerando":"Aguardando"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-[14px] font-bold text-[#0F1111]",children:["+",e.renda_diaria.toLocaleString()," Kz"]}),s.jsx("p",{className:"text-[10px] text-[#565959] font-bold",children:"/dia"})]})]},e.id))})]})]})})};export{l as default};
