import{r as e,R as s,j as a}from"./react-vendor-0Am1niUb.js";import{u as t,s as r,S as i}from"./index-BonT0QVc.js";import"./supabase-BsxaddrC.js";import"./vendor-DtN75V_I.js";const n=({onNavigate:n,showToast:l,balance:c})=>{const{withLoading:o}=t(),[d,x]=e.useState([]),[p,m]=e.useState([]),[u,h]=e.useState(!0),[g,b]=e.useState(null),[f,j]=e.useState(!1);e.useEffect(()=>{y();const e=r.channel("shop-updates").on("postgres_changes",{event:"*",schema:"public",table:"products"},()=>w()).subscribe();return()=>{e.unsubscribe()}},[]);const y=async()=>{h(!0),await Promise.all([w(),N()]),h(!1)},w=async()=>{const{data:e}=await r.from("products").select("*").eq("status","active").order("price",{ascending:!0});e&&x(e)},N=async()=>{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:s}=await r.from("historico_compras").select("product_id").eq("user_id",e.id);s&&m(s.map(e=>e.product_id))},v=s.useCallback(e=>{p.includes(e.id)?l?.("Limite excedido, compre outro!","warning"):b(e)},[p,l]),k=s.useCallback(e=>{const[s,a]=e.toFixed(2).split(".");return{inteiro:s,centavos:a}},[]);return a.jsxs("div",{className:"bg-[#F4F7F6] min-h-screen text-gray-900 font-display antialiased pb-32",children:[a.jsxs("main",{className:"max-w-md mx-auto pt-8",children:[a.jsxs("div",{className:"px-6 mb-8 mt-4",children:[a.jsx("h1",{className:"text-[28px] font-black tracking-tight leading-tight",children:"BP Marketplace"}),a.jsx("p",{className:"text-gray-400 text-[13px] font-medium mt-1 uppercase tracking-widest",children:"Equipamentos de energia solar"})]}),u?a.jsx("div",{className:"flex flex-col items-center justify-center py-40 gap-4",children:a.jsx(i,{size:"w-12 h-12",color:"text-[#00C853]"})}):a.jsx("div",{className:"flex flex-col gap-6 py-4",children:d.map(e=>{const{inteiro:s,centavos:t}=k(e.price),r=p.includes(e.id);return a.jsxs("div",{className:"group relative flex flex-col gap-4 p-6 mx-5 bg-white rounded-[40px] shadow-premium border border-white/50 transition-all hover:scale-[1.01] active:scale-[0.98]",children:[a.jsxs("div",{className:"flex justify-between items-center mb-1",children:[a.jsx("span",{className:"px-3 py-1 bg-[#EEFFF5] text-[#00C853] text-[9px] font-black rounded-full uppercase tracking-widest border border-[#00C853]/10",children:"Oficial"}),e.price<1e4&&a.jsx("span",{className:"px-3 py-1 bg-[#FFFBEB] text-[#D97706] text-[9px] font-black rounded-full uppercase tracking-widest border border-[#FDE68A]",children:"Popular"})]}),a.jsxs("div",{className:"flex gap-4 items-center",children:[a.jsx("div",{className:"relative w-32 h-32 bg-gray-50 rounded-[28px] overflow-hidden shrink-0 flex items-center justify-center p-3 shadow-inner group-hover:bg-white transition-colors duration-500",children:a.jsx("img",{loading:"lazy",decoding:"async",src:e.image_url||"/placeholder_product.png",alt:e.name,className:"max-w-full max-h-full object-contain drop-shadow-md group-hover:scale-110 transition-transform duration-500"})}),a.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between h-32",children:[a.jsx("h3",{className:"text-[17px] font-black leading-tight text-gray-900 mb-2 line-clamp-2 pr-4 tracking-tight",children:e.name}),a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"size-5 rounded-lg bg-[#EEFFF5] flex items-center justify-center",children:a.jsx("span",{className:"material-symbols-outlined text-[14px] text-[#00C853]",children:"bolt"})}),a.jsxs("p",{className:"text-[12px] font-bold text-gray-500 tracking-tight",children:["Renda ",a.jsxs("span",{className:"text-[#00C853] font-black",children:["Kz ",e.daily_income?.toLocaleString()]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"size-5 rounded-lg bg-gray-50 flex items-center justify-center",children:a.jsx("span",{className:"material-symbols-outlined text-[14px] text-gray-400",children:"schedule"})}),a.jsxs("p",{className:"text-[12px] font-bold text-gray-500 tracking-tight",children:["Ativo por ",a.jsxs("span",{className:"text-gray-900 font-black",children:[e.duration_days," dias"]})]})]})]})]})]}),a.jsxs("div",{className:"mt-4 pt-5 border-t border-gray-50 flex items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-baseline",children:[a.jsx("span",{className:"text-[12px] font-black text-[#00C853] pr-1",children:"KZs"}),a.jsx("span",{className:"text-[26px] font-black text-gray-900 tracking-tighter",children:s}),a.jsxs("span",{className:"text-[12px] font-black text-gray-400",children:[",",t]})]}),a.jsx("button",{onClick:()=>v(e),disabled:r,className:"h-[54px] px-8 rounded-[20px] text-[13px] font-black transition-all active:scale-[0.96] shadow-premium uppercase tracking-[0.1em] "+(r?"bg-gray-100 text-gray-300 cursor-not-allowed border border-gray-200 shadow-none":"bg-gray-900 hover:bg-[#00C853] text-white"),children:r?"Adquirido":"Investir"})]}),r&&a.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rotate-12 pointer-events-none opacity-10",children:a.jsx("h4",{className:"text-[40px] font-black text-gray-900 border-8 border-gray-900 px-6 py-2 uppercase tracking-widest whitespace-nowrap",children:"LIMITE EXCEDIDO"})})]},e.id)})})]}),g&&a.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-6 animate-in fade-in duration-300",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-md",onClick:()=>!f&&b(null)}),a.jsxs("div",{className:"relative w-full max-w-sm bg-white/95 backdrop-blur-xl rounded-t-[48px] sm:rounded-[40px] p-8 pb-10 sm:pb-8 border border-white/50 shadow-2xl scale-100 animate-in slide-in-from-bottom-20 sm:slide-in-from-bottom-0 sm:zoom-in-95 duration-500",children:[a.jsx("div",{className:"w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-8 sm:hidden"}),a.jsxs("div",{className:"flex flex-col items-center text-center mb-8",children:[a.jsx("div",{className:"size-20 rounded-[32px] bg-gray-50 flex items-center justify-center mb-5 shadow-inner",children:a.jsx("img",{src:g.image_url||"/placeholder_product.png",className:"size-12 object-contain"})}),a.jsx("h3",{className:"text-[22px] font-black text-gray-900 mb-2 tracking-tight",children:"Confirmar Investimento"}),a.jsxs("p",{className:"text-gray-500 text-[14px] font-medium leading-relaxed px-4",children:["Você está adquirindo o ",a.jsx("span",{className:"font-bold text-gray-900",children:g.name})," por ",a.jsxs("span",{className:"text-[#00C853] font-black",children:["Kz ",g.price.toLocaleString()]}),"."]})]}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx("button",{disabled:f,onClick:async()=>{if(g){j(!0);try{const{data:{user:e}}=await r.auth.getUser();if(!e)throw new Error("Sessão expirada");if(c<g.price)throw new Error("Balance insuficiente");const{data:s,error:a}=await r.rpc("purchase_product",{p_product_id:g.id,p_user_id:e.id});if(a)throw a;if(!1===s?.success)throw new Error(s.message);b(null),l?.(s?.message||"Compra sucedida!","success"),m(e=>[...e,g.id]),setTimeout(()=>n("purchase-history"),1e3)}catch(e){l?.(e.message||"Falha na transação","error")}finally{j(!1)}}},className:"w-full h-[58px] bg-[#00C853] hover:brightness-110 rounded-[22px] font-black text-white text-[15px] transition-all active:scale-[0.96] flex items-center justify-center uppercase tracking-widest shadow-[0_12px_32px_-8px_rgba(0,200,83,0.5)]",children:f?a.jsx(i,{size:"w-6 h-6",color:"text-white"}):"Confirmar Pagamento"}),a.jsx("button",{disabled:f,onClick:()=>b(null),className:"w-full h-[54px] bg-transparent text-gray-400 font-bold text-[13px] uppercase tracking-widest hover:text-gray-600 transition-all",children:"Voltar"})]}),a.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8 opacity-20 grayscale",children:[a.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"verified_user"}),a.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:"Criptografia BP SECURE"})]})]})]})]})};export{n as default};
