import{r as e,j as t}from"./react-vendor-0Am1niUb.js";import{a,s,S as r}from"./index-BonT0QVc.js";import"./supabase-BsxaddrC.js";import"./vendor-DtN75V_I.js";const l=({onNavigate:l,onOpenSupport:n,showToast:i})=>{const{runWithTimeout:o}=a(),[c,d]=e.useState(""),[x,m]=e.useState(!1),[u,p]=e.useState(!1),[b,f]=e.useState(!1),[h,g]=e.useState(null),[j,y]=e.useState([]),[v,N]=e.useState(!0);e.useEffect(()=>{w()},[]);const w=async()=>{try{const{data:{user:e}}=await s.auth.getUser();if(!e)return;const{data:t,error:a}=await o(()=>s.from("bonus_transacoes").select("*").eq("user_id",e.id).order("data_recebimento",{ascending:!1}).limit(10));!a&&t&&y(t)}catch(e){}finally{N(!1)}};return t.jsxs("div",{className:"bg-white text-black min-h-screen flex flex-col font-sans antialiased",children:[t.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsx("button",{onClick:()=>l("home"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),t.jsx("div",{className:"px-6 py-1 bg-white/20 backdrop-blur-md rounded-full border border-white/30",children:t.jsx("span",{className:"text-white font-black tracking-widest text-sm",children:"BP ANGOLA"})}),t.jsx("button",{onClick:()=>n?.(),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[24px]",children:"help_outline"})})]})}),t.jsxs("main",{className:"flex-1 flex flex-col items-center px-4 max-w-lg mx-auto w-full pb-20 pt-6",children:[t.jsx("div",{className:"mb-4",children:t.jsx("span",{className:"bg-[#00C853]/10 text-[#00C853] px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-[#00C853]/20",children:u?"PARABÉNS!":"RESGATE SEU CÓDIGO"})}),t.jsx("h1",{className:"text-[#111] tracking-tight text-[26px] font-black leading-tight px-4 text-center pb-2",children:u?"Presente Resgatado!":"Tens um presente para abrir!"}),t.jsx("p",{className:"text-gray-500 text-[14px] font-medium leading-relaxed pb-6 px-10 text-center",children:u?"O valor foi adicionado ao seu saldo principal.":"Introduz o teu código abaixo para resgatar agora."}),!u&&t.jsx("div",{className:"w-full px-6 mb-10",children:t.jsxs("div",{className:"bg-gray-50 rounded-2xl h-16 flex items-center px-5 gap-3 relative border border-gray-100 focus-within:border-[#00C853] focus-within:ring-4 focus-within:ring-[#00C853]/10 transition-all",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[28px]",children:"redeem"}),t.jsx("input",{type:"text",placeholder:"Insira o seu código aqui",value:c,onChange:e=>d(e.target.value.toUpperCase()),disabled:x||b,className:"bg-transparent flex-1 h-full outline-none text-[#111] font-bold placeholder:text-gray-400 text-[15px]"})]})}),t.jsxs("div",{className:"relative w-full flex items-center justify-center mb-10 h-64",children:[t.jsx("div",{className:"absolute size-64 bg-[#00C853]/10 rounded-full blur-[60px] transition-all duration-1000 "+(u?"scale-150 opacity-100":"scale-75 opacity-20")}),t.jsx("div",{className:"absolute size-40 bg-yellow-400/10 rounded-full blur-[40px] transition-all duration-1000 "+(u?"scale-150 opacity-100 animate-pulse":"scale-0 opacity-0")}),t.jsxs("div",{className:`relative z-10 transition-all duration-500 transform \n            ${b?"animate-shake scale-105":""} \n            ${u?"scale-125":""}`,children:[t.jsxs("div",{className:"relative w-44 h-44 bg-[#1e1c14] rounded-[32px] border-4 border-[#2d2b22] shadow-2xl overflow-hidden flex flex-col",children:[t.jsx("div",{className:"absolute top-0 inset-x-0 h-1/2 bg-[#2d2b22] border-b-4 border-[#1e1c14] z-20 transition-all duration-700 origin-top\n                "+(u?"-rotate-x-110 -translate-y-8 opacity-0":"rotate-x-0 translate-y-0 opacity-100"),children:t.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 w-12 h-1.5 bg-black/20 rounded-full"})}),t.jsxs("div",{className:"flex-1 flex items-center justify-center relative bg-gradient-to-br from-[#1e1c14] to-black",children:[t.jsx("div",{className:"size-16 rounded-full flex items-center justify-center transition-all duration-700 z-30\n                  "+(u?"bg-[#00C853] scale-0 opacity-0 rotate-180":"bg-[#2d2b22] border-4 border-[#3a3830] shadow-inner"),children:t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[32px] font-black",style:{fontVariationSettings:"'FILL' 1"},children:"lock"})}),u&&t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center animate-reveal-reward overflow-visible",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#00C853]/20 via-transparent to-transparent"}),t.jsx("span",{className:"material-symbols-outlined text-yellow-400 text-5xl mb-1 animate-bounce drop-shadow-[0_0_15px_rgba(250,204,21,0.5)]",children:"payments"}),t.jsxs("p",{className:"text-white text-xl font-black tracking-tight",children:["+Kz ",h?.toLocaleString()]})]})]})]}),t.jsx("div",{className:"absolute -bottom-2 -right-4 bg-[#00C853] text-black font-black px-5 py-2.5 rounded-2xl shadow-xl transition-all duration-700\n              "+(u?"scale-110 -translate-y-4 -translate-x-4 rotate-0":"rotate-12 hover:rotate-0"),children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"material-symbols-outlined text-xl",style:{fontVariationSettings:"'FILL' 1"},children:"monetization_on"}),t.jsx("span",{className:"text-xl font-black",children:"Kz"})]})}),u&&t.jsxs("div",{className:"absolute inset-x-[-40px] inset-y-[-40px] pointer-events-none z-0",children:[t.jsx("div",{className:"absolute top-1/4 left-1/4 size-2 bg-yellow-400 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-3/4 right-1/4 size-3 bg-[#00C853] rounded-full animate-bounce [animation-delay:0.2s]"}),t.jsx("div",{className:"absolute top-1/2 left-0 size-2 bg-white rounded-full animate-ping [animation-delay:0.4s]"})]})]})]}),t.jsxs("div",{className:"w-full space-y-4 px-6 relative z-20",children:[u?t.jsxs("div",{className:"space-y-3 animate-fade-in-up",children:[t.jsx("div",{className:"bg-[#00C853]/5 border border-[#00C853]/10 p-4 rounded-2xl text-center mb-2",children:t.jsxs("p",{className:"text-[#00C853] text-sm font-bold",children:["Resgate Realizado: ",t.jsxs("span",{className:"text-black font-black",children:["Kz ",h?.toLocaleString()]})]})}),t.jsx("button",{onClick:()=>{p(!1),g(null)},className:"flex w-full items-center justify-center rounded-2xl h-[45px] bg-white border-2 border-[#00C853] text-[#00C853] text-base font-black active:scale-95 transition-all shadow-sm",children:t.jsx("span",{children:"Resgatar Outro Código"})})]}):t.jsx("button",{onClick:async()=>{if(c.trim()){m(!0);try{const{data:{user:e}}=await s.auth.getUser();if(!e)return void l("login");const{data:t,error:a}=await s.rpc("redeem_gift_code",{p_code:c.trim()});if(a)throw new Error("Não foi possível processar o pedido. Tente novamente");if(!t.success)throw new Error(t.message||"Código inválido ou expirado.");f(!0),setTimeout(()=>{g(t.amount||0),p(!0),f(!1),d(""),i?.(t.message||"Resgate sucedido!","success"),w()},1500)}catch(e){i?.(e.message,"error")}finally{m(!1)}}else i?.("Por favor, digite código.","warning")},disabled:x||b,className:"flex w-full items-center justify-center rounded-2xl h-[45px] bg-[#00C853] text-white text-[16px] font-black active:scale-95 transition-all shadow-lg shadow-[#00C853]/20\n                "+(x||b?"opacity-50 grayscale":"hover:brightness-110"),children:t.jsx("span",{children:x||b?"Validando Código...":"Abrir Presente Agora"})}),!u&&t.jsx("button",{onClick:()=>l("home"),className:"w-full text-center text-gray-400 text-[12px] font-black py-2 tracking-widest uppercase hover:text-[#111] transition-colors",children:"Guardar para mais tarde"})]}),t.jsxs("div",{className:"w-full mt-14 px-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6 px-3",children:[t.jsx("h3",{className:"text-[#111] text-lg font-black tracking-tight",children:"Presentes Resgatados"}),t.jsx("button",{onClick:()=>l("reward-claim"),className:"text-[#00C853] text-[13px] font-bold hover:underline",children:"Ver todos"})]}),t.jsx("div",{className:"flex flex-col gap-3",children:v?t.jsx("div",{className:"flex justify-center p-8",children:t.jsx(r,{size:"w-8 h-8"})}):j.length>0?j.map((e,a)=>t.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/50 border rounded-2xl transition-all "+(0===a&&u?"border-primary ring-2 ring-primary/20 bg-primary/5 scale-[1.02]":"border-gray-100"),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"size-10 rounded-full flex items-center justify-center "+("success"===e.status?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:t.jsx("span",{className:"material-symbols-outlined icon-filled",children:"success"===e.status?"check_circle":"error"})}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"text-black font-bold text-sm",children:"success"===e.status?"Resgate Concluído":"Falha no Resgate"}),0===a&&u&&t.jsx("span",{className:"bg-primary text-[#181711] text-[10px] font-black px-1.5 py-0.5 rounded uppercase",children:"Recente"})]}),t.jsxs("p",{className:"text-black/50 text-xs text-left",children:[new Date(e.data_recebimento).toLocaleTimeString()," • ",(()=>{const t=e.codigo_presente||"";return t.length<=4?t:t.slice(0,2)+"**"+t.slice(-2)})()]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"font-black block "+("success"===e.status?"text-green-600":"text-red-400"),children:"success"===e.status?`+ Kz ${e.valor_recebido||0}`:"Inválido"}),t.jsx("span",{className:"text-[10px] text-black/40 font-bold uppercase",children:new Date(e.data_recebimento).toLocaleDateString()})]})]},e.id)):t.jsx("div",{className:"text-center py-10 bg-gray-50/50 rounded-2xl border-2 border-dashed border-gray-100",children:t.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Nenhum presente resgatado ainda."})})})]})]}),t.jsx("div",{className:"h-2 bg-primary/5 w-full mt-auto"}),t.jsx("style",{children:"\n        @keyframes shake {\n          0%, 100% { transform: translateX(0); }\n          25% { transform: translateX(-8px) rotate(-2deg); }\n          50% { transform: translateX(8px) rotate(2deg); }\n          75% { transform: translateX(-4px) rotate(-1deg); }\n        }\n        .animate-shake {\n          animation: shake 0.3s ease-in-out infinite;\n        }\n        \n        @keyframes reveal-reward {\n          0% { transform: scale(0) translateY(20px); opacity: 0; }\n          60% { transform: scale(1.1) translateY(-10px); opacity: 1; }\n          100% { transform: scale(1) translateY(0); opacity: 1; }\n        }\n        .animate-reveal-reward {\n          animation: reveal-reward 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;\n        }\n\n        @keyframes fade-in-up {\n          from { opacity: 0; transform: translateY(10px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        .animate-fade-in-up {\n          animation: fade-in-up 0.5s ease-out forwards;\n        }\n\n        .rotate-x-110 { transform: rotateX(-110deg); }\n      "})]})};export{l as default};
