import{r as e,R as t,j as a}from"./react-vendor-C8-TlGsU.js";import{s,S as r}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const i={pendente:{label:"Pendente",color:"text-amber-600"},confirmado:{label:"Ativo",color:"text-green-600"},cancelado:{label:"Cancelado",color:"text-red-600"}},l=({onNavigate:l,showToast:n,profile:o})=>{const[c,d]=e.useState([]),[m,x]=e.useState(!0),[p,h]=e.useState(!1),u=t.useRef(!0),b=e.useCallback(async(e=!1)=>{if(o?.id){e?x(!0):h(!0);try{const{data:e,error:a}=await s.from("historico_compras").select("*").eq("user_id",o.id).order("data_compra",{ascending:!1});if(a)throw a;let r={};try{const{data:e}=await s.from("products").select("name, image_url");e?.forEach(e=>{e?.name&&(r[e.name.trim().toLowerCase()]=e.image_url)})}catch(t){}const i=(e||[]).map(e=>{const t=e?.nome_produto?.trim().toLowerCase(),a=t?r[t]:null;return{...e,image_url:a||null,category:"Shop"}});d(i)}catch(a){n?.("Erro ao carregar histórico","error")}finally{x(!1),h(!1)}}},[o?.id,n]);return e.useEffect(()=>{let e;u.current?(b(!0),u.current=!1):b(!1);return(async()=>{o?.id&&(e=s.channel(`purchases-history-sync-${o.id}`).on("postgres_changes",{event:"*",schema:"public",table:"historico_compras",filter:`user_id=eq.${o.id}`},()=>b(!1)).subscribe())})(),()=>{e&&s.removeChannel(e)}},[b]),a.jsxs("div",{className:"bg-white min-h-screen text-[#0F1111] font-sans selection:bg-amber-100 pb-32",children:[a.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:a.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[a.jsx("button",{onClick:()=>l("profile"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:a.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),a.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Minhas Compras"}),a.jsx("div",{className:"w-11",children:p&&a.jsx("div",{className:"size-5 rounded-full border-2 border-white/30 border-t-white animate-spin"})})]})}),a.jsxs("main",{className:"max-w-md mx-auto",children:[m?a.jsxs("div",{className:"flex flex-col items-center justify-center py-40 gap-4",children:[a.jsx(r,{size:"w-10 h-10",color:"text-[#00C853]"}),a.jsx("p",{className:"text-[12px] text-[#565959] font-medium animate-pulse",children:"Aguarde um momento..."})]}):0===c.length?a.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-center px-10 animate-in fade-in duration-700",children:[a.jsx("div",{className:"size-20 rounded-full bg-gray-50 flex items-center justify-center mb-6",children:a.jsx("span",{className:"material-symbols-outlined text-gray-300 text-5xl",children:"receipt_long"})}),a.jsx("h3",{className:"text-[#0F1111] font-bold text-lg mb-2",children:"Sem pedidos"}),a.jsx("p",{className:"text-[#565959] text-sm leading-relaxed mb-8",children:"Você ainda não realizou nenhuma compra. Visite a loja para ver as ofertas."}),a.jsx("button",{onClick:()=>l("shop"),className:"w-full py-3 bg-[#00C853] hover:bg-[#00C853] rounded-full font-medium text-[14px] border border-[#00C853] active:scale-95 transition-all",children:"Ir para Loja"})]}):a.jsx("div",{className:"flex flex-col divide-y divide-gray-100 border-b border-gray-100",children:c.map((e,t)=>{const{inteiro:s,centavos:r}=(e=>{const[t,a]=(Number(e)||0).toFixed(2).split(".");return{inteiro:t,centavos:a}})(e.preco),l=i[e.status]||i.confirmado,n=new Date(e.data_compra);return a.jsxs("div",{className:"flex gap-4 p-4 items-start active:bg-gray-50 transition-colors animate-in slide-in-from-bottom-2 duration-300",children:[a.jsxs("div",{className:"relative w-32 h-32 bg-gray-50 rounded-lg overflow-hidden shrink-0 flex items-center justify-center p-2 border border-gray-100",children:[a.jsx("img",{loading:"lazy",decoding:"async",src:e.image_url||"/placeholder_product.png",alt:"",className:"max-w-full max-h-full object-contain",onError:e=>e.currentTarget.src="/placeholder_product.png"}),a.jsx("div",{className:"absolute top-0 right-0 bg-white px-1.5 py-0.5 rounded-bl-sm border-l border-b border-gray-100",children:a.jsxs("span",{className:"text-[8px] font-bold text-[#565959]",children:["ID: ",e.id.toString().slice(-4)]})})]}),a.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[a.jsxs("span",{className:`text-[11px] font-bold ${l.color}`,children:["Pedido ",l.label]}),a.jsx("span",{className:"size-1 bg-gray-300 rounded-full"}),a.jsx("span",{className:"text-[11px] text-[#565959] font-medium",children:isNaN(n.getTime())?"Data indisponível":n.toLocaleDateString("pt-PT",{day:"2-digit",month:"short"})})]}),a.jsx("h3",{className:"text-[14px] font-medium leading-tight line-clamp-2 text-[#0F1111] mb-1",children:e.nome_produto}),a.jsxs("div",{className:"flex items-baseline mb-2",children:[a.jsx("span",{className:"text-[11px] font-bold mr-0.5",children:"Kz"}),a.jsx("span",{className:"text-[20px] font-bold tracking-tight",children:s}),a.jsx("span",{className:"text-[11px] font-bold",children:r})]}),a.jsxs("div",{className:"p-2 ml-[-4px] rounded-lg bg-[#F7F8F8] border border-gray-200/50 space-y-1 w-full",children:[a.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[a.jsx("span",{className:"text-[#565959] font-bold uppercase tracking-tighter",children:"Rendimento"}),a.jsxs("span",{className:"text-[#007600] font-black",children:["+ Kz ",Number(e.rendimento_diario||0).toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[a.jsx("span",{className:"text-[#565959] font-bold uppercase tracking-tighter",children:"Vencimento"}),a.jsx("span",{className:"text-[#0F1111] font-bold",children:isNaN(new Date(e.data_expiracao).getTime())?"--":new Date(e.data_expiracao).toLocaleDateString("pt-PT")})]})]})]})]},`${e.id}-${t}`)})}),c.length>0&&a.jsxs("div",{className:"p-10 text-center bg-[#F7F8F8] border-t border-gray-100",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[a.jsx("span",{className:"material-symbols-outlined text-[#007600] text-xl",children:"verified_user"}),a.jsx("p",{className:"text-[12px] font-bold text-[#007600]",children:"Proteção ao Consumidor BP"})]}),a.jsx("p",{className:"text-[11px] text-[#565959] leading-relaxed max-w-[240px] mx-auto",children:"Sua segurança é nossa prioridade. Em caso de dúvidas sobre seus rendimentos, consulte o suporte 24h."})]})]})]})};export{l as default};
