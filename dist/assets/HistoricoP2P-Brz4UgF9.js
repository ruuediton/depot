import{r as e,j as t}from"./react-vendor-C8-TlGsU.js";import{s,S as a}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const r=({onNavigate:r})=>{const[n,i]=e.useState(!0),[c,l]=e.useState([]),[d,o]=e.useState("Enviados"),[x,p]=e.useState(null);e.useEffect(()=>{h()},[]);const m=e=>{if(!e)return"--- --- ---";const t=e.replace(/\s/g,"");if(t.length<7)return e;return`${t.substring(0,3)} **** ${t.substring(t.length-2)}`},h=async()=>{i(!0);try{const{data:{session:e}}=await s.auth.getSession();if(!e)return;const t=e.user.id;p(t);const{data:a,error:r}=await s.from("transacoes_p2p").select("*").or(`sender_id.eq.${t},receiver_id.eq.${t}`).order("created_at",{ascending:!1});if(r)throw r;if(!a)return l([]),void i(!1);const n=[...new Set(a.flatMap(e=>[e.sender_id,e.receiver_id]))],{data:c}=await s.from("profiles").select("id, phone").in("id",n),d=(c||[]).reduce((e,t)=>(e[t.id]=t.phone,e),{}),o=a.map(e=>({...e,sender:{phone:d[e.sender_id]||""},receiver:{phone:d[e.receiver_id]||""}}));l(o)}catch(e){}finally{i(!1)}},u=e.useMemo(()=>x?c.filter(e=>"Enviados"===d?e.sender_id===x:e.receiver_id===x):[],[c,d,x]),g=e.useMemo(()=>{const e={},t=new Date,s=new Date;return s.setDate(t.getDate()-1),u.forEach(a=>{const r=new Date(a.created_at);let n="";n=r.toDateString()===t.toDateString()?"HOJE":r.toDateString()===s.toDateString()?"ONTEM":r.toLocaleDateString("pt-PT",{day:"2-digit",month:"long"}).toUpperCase(),e[n]||(e[n]=[]),e[n].push(a)}),e},[u]);return t.jsxs("div",{className:"bg-white min-h-screen font-sans text-black antialiased pb-24",children:[t.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsx("button",{onClick:()=>r("p2p-transfer"),className:"size-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md active:scale-90 transition-all",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),t.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Histórico de Envios"}),t.jsx("div",{className:"size-11"})]})}),t.jsxs("main",{className:"px-5 -mt-8 relative z-20",children:[t.jsx("div",{className:"flex gap-2 mb-8 bg-gray-50 p-1.5 rounded-[28px] border border-gray-100 shadow-sm",children:["Enviados","Recebidos"].map(e=>t.jsx("button",{onClick:()=>o(e),className:"flex-1 py-3 rounded-[22px] text-[12px] font-black uppercase tracking-widest transition-all "+(d===e?"bg-[#003816] text-white shadow-lg":"text-gray-400 opacity-60"),children:e},e))}),n?t.jsxs("div",{className:"flex flex-col items-center justify-center py-24 animate-pulse",children:[t.jsx(a,{size:"w-10 h-10",color:"text-[#00C853]"}),t.jsx("p",{className:"mt-4 text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Sincronizando registros..."})]}):Object.keys(g).length>0?Object.keys(g).map(e=>t.jsxs("div",{className:"mb-8 animate-in fade-in slide-in-from-bottom-2 duration-500",children:[t.jsx("p",{className:"text-gray-400 text-[10px] font-black tracking-[0.2em] mb-4 ml-1 uppercase",children:e}),t.jsx("div",{className:"space-y-4",children:g[e].map(e=>{const s=e.sender_id===x,a=s?e.receiver?.phone:e.sender?.phone,r="completed"===e.status||"sucesso"===e.status;return t.jsxs("div",{className:"bg-white rounded-[26px] p-4 border border-gray-50 shadow-sm flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"size-12 rounded-2xl flex items-center justify-center shrink-0 "+(s?"bg-gray-100 text-gray-400":"bg-[#00C853]/10 text-[#00C853]"),children:t.jsx("span",{className:"material-symbols-outlined text-[24px]",children:s?"outbound":"south_west"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-[14px] font-black text-black leading-tight mb-1 truncate",children:s?"P2P Enviado":"P2P Recebido"}),t.jsx("p",{className:"text-[11px] text-gray-400 font-bold opacity-70",children:s?`Para: ${m(a||"")}`:`De: ${m(a||"")}`}),t.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[t.jsx("span",{className:"text-[8px] font-black uppercase px-2 py-0.5 rounded-full "+(r?"bg-green-50 text-[#00C853]":"bg-orange-50 text-orange-600"),children:r?"Sucesso":e.status||"Pendente"}),t.jsx("span",{className:"text-[9px] text-gray-300 font-bold",children:new Date(e.created_at).toLocaleTimeString("pt-AO",{hour:"2-digit",minute:"2-digit"})})]})]})]}),t.jsxs("div",{className:"text-right shrink-0",children:[t.jsxs("p",{className:"text-[16px] font-black tracking-tighter "+(s?"text-black":"text-[#00C853]"),children:[s?"-":"+"," Kz ",e.amount.toLocaleString("pt-AO")]}),s&&e.fee>0&&t.jsxs("p",{className:"text-[10px] text-red-500 font-bold mt-0.5",children:["Taxa: Kz ",e.fee.toLocaleString()]})]})]},e.id)})})]},e)):t.jsxs("div",{className:"flex flex-col items-center justify-center py-24 opacity-30 text-center px-10",children:[t.jsx("span",{className:"material-symbols-outlined text-6xl text-gray-200 mb-4",children:"account_balance_wallet"}),t.jsxs("p",{className:"font-bold text-[12px] text-gray-400 uppercase tracking-[0.2em] leading-relaxed",children:["Nenhuma transferência ",d.toLowerCase()," encontrada"]})]})]})]})};export{r as default};
