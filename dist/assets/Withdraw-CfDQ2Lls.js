import{r as e,j as t}from"./react-vendor-C8-TlGsU.js";import{u as a,s,S as r}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const n=({onNavigate:n,showToast:l})=>{const{withLoading:i}=a(),[c,o]=e.useState(0),[d,x]=e.useState(null),[m,p]=e.useState(""),[h,u]=e.useState(""),[b,g]=e.useState(!1),[f,j]=e.useState(!0);e.useEffect(()=>{w()},[]);const w=async()=>{try{const{data:{user:e}}=await s.auth.getUser();if(!e)return n("login");const{data:t}=await s.from("profiles").select("balance").eq("id",e.id).single();t&&o(t.balance||0);const{data:a}=await s.rpc("get_my_bank_accounts");a&&a.length>0&&x(a[0])}catch(e){}finally{j(!1)}},N=e=>{if(!e)return"";const t=e.replace(/\s/g,"");return t.length<13?e:`${t.substring(0,8)}*****${t.substring(t.length-9)}`};return f?t.jsx("div",{className:"flex justify-center items-center h-screen bg-white",children:t.jsx(r,{size:"w-8 h-8",color:"text-[#00C853]"})}):t.jsxs("div",{className:"bg-white min-h-screen font-sans text-[#0F1111] pb-20",children:[t.jsx("header",{className:"relative header-gradient-mixture pb-20 pt-8 px-4 overflow-hidden",children:t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsx("button",{onClick:()=>n("home"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),t.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Retirada"}),t.jsx("button",{onClick:()=>n("withdrawal-history"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"history"})})]})}),t.jsxs("main",{className:"px-4 -mt-8 relative z-10 space-y-6",children:[t.jsxs("div",{className:"bg-white border border-gray-100 rounded-[28px] p-6 shadow-premium relative overflow-hidden",children:[t.jsx("div",{className:"absolute right-0 top-0 w-32 h-32 bg-[#00C853]/5 rounded-full blur-2xl -mr-16 -mt-16"}),t.jsx("div",{className:"flex items-center gap-2 mb-2",children:t.jsx("p",{className:"text-[#565959] text-[13px] font-medium leading-none",children:"Saldo"})}),t.jsxs("div",{className:"flex items-baseline gap-1.5 leading-none",children:[t.jsx("span",{className:"text-[28px] font-black text-[#111] tracking-tighter",children:c.toLocaleString("pt-AO",{minimumFractionDigits:2})}),t.jsx("span",{className:"text-[13px] font-bold text-[#565959]",children:"KZs"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[13px] font-bold text-[#0F1111]",children:"Quantia Desejada"}),t.jsxs("div",{className:"bg-gray-50 rounded-xl h-[50px] flex items-center px-4 gap-3 relative border border-transparent focus-within:border-[#00C853] transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"payments"}),t.jsx("input",{type:"number",value:m,onChange:e=>p(e.target.value),placeholder:"0,00",className:"bg-transparent flex-1 h-full outline-none text-[#111] font-medium placeholder:text-gray-400 text-[14px]"}),t.jsx("span",{className:"text-[14px] font-bold text-gray-400",children:"Kz"})]})]}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:[2e3,5e3,1e4,2e4].map(e=>t.jsx("button",{onClick:()=>(e=>{p(e.toString())})(e),className:"py-2.5 bg-gray-50 border border-gray-100 rounded-lg text-[12px] font-bold text-[#0F1111] hover:bg-white active:scale-95 transition-all",children:e.toLocaleString("pt-AO")},e))}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"flex justify-between items-center ml-1",children:t.jsx("span",{className:"text-[13px] font-bold text-[#0F1111]",children:"Conta de Destino"})}),d?t.jsxs("button",{onClick:()=>n("add-bank"),className:"w-full flex items-center gap-4 p-4 border border-gray-100 rounded-[12px] bg-gray-50 hover:bg-white transition-all text-left active:scale-[0.99]",children:[t.jsx("div",{className:"size-10 rounded-lg bg-white flex items-center justify-center text-[#00C853] shadow-sm",children:t.jsx("span",{className:"material-symbols-outlined",children:"account_balance"})}),t.jsxs("div",{className:"flex-1 overflow-hidden",children:[t.jsx("p",{className:"text-[14px] font-bold text-[#0F1111] truncate",children:d.nome_banco}),t.jsx("p",{className:"text-[11px] text-[#565959] font-mono truncate",children:N(d.iban)})]}),t.jsx("span",{className:"material-symbols-outlined text-gray-400 group-hover:text-[#00C853] transition-colors",children:"chevron_right"})]}):t.jsxs("button",{onClick:()=>n("add-bank"),className:"w-full py-4 border-2 border-dashed border-gray-100 rounded-xl flex items-center justify-center gap-2 text-[#565959] font-bold text-[13px] hover:bg-gray-50 transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"add"}),"Adicionar Conta Bancária"]})]})]}),t.jsx("div",{className:"fixed bottom-0 inset-x-0 flex justify-center p-4 bg-white/80 backdrop-blur-xl border-t border-gray-100 pb-10 z-[100]",children:t.jsx("div",{className:"w-full max-w-md px-6",children:t.jsxs("button",{onClick:()=>{if(!d)return l?.("Você precisa vincular uma conta bancária.","warning"),void n("add-bank");const e=parseFloat(m);if(!m||isNaN(e)||e<=0)return void l?.("Digite um valor válido.","error");if(e<300)return void l?.("Valor mínimo de saque é 300 Kz.","warning");if(e>2e5)return void l?.("Valor máximo de saque é 200.000 Kz.","warning");if(e>c)return void l?.("Saldo insuficiente.","error");const t=new Date((new Date).toLocaleString("en-US",{timeZone:"Africa/Luanda"})).getHours();t<10||t>=16?l?.("O horário de retirada é das 10:00 às 16:00 (Fuso Angola).","warning"):g(!0)},className:"w-full bg-[#00C853] text-white font-black text-[16px] py-4 rounded-[20px] shadow-xl shadow-[#00C853]/20 active:scale-[0.96] hover:brightness-105 transition-all flex items-center justify-center gap-2 group",children:["Confirme",t.jsx("span",{className:"material-symbols-outlined transition-transform group-active:translate-x-1",children:"arrow_forward"})]})})}),b&&t.jsx("div",{className:"fixed inset-0 z-[9999] bg-white/60 backdrop-blur-md flex items-end sm:items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white w-full max-w-sm rounded-[32px] shadow-2xl border border-gray-50 overflow-hidden animate-in fade-in slide-in-from-bottom-8 duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-2",children:[t.jsx("span",{className:"text-[14px] font-black uppercase tracking-[0.1em] text-gray-400",children:"Verificação"}),t.jsx("button",{onClick:()=>g(!1),className:"size-8 rounded-full bg-gray-50 flex items-center justify-center active:scale-90 transition-all",children:t.jsx("span",{className:"material-symbols-outlined text-[18px] text-gray-400",children:"close"})})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{className:"bg-[#F8FAF8] rounded-2xl p-5 space-y-3 border border-gray-50/50",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-wider",children:"Banco"}),t.jsx("span",{className:"text-[13px] font-bold text-[#111]",children:d?.nome_banco})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-wider",children:"IBAN"}),t.jsx("span",{className:"text-[12px] font-mono font-medium text-[#111]",children:N(d?.iban)})]}),t.jsxs("div",{className:"flex justify-between items-center pt-1",children:[t.jsx("span",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-wider",children:"Solicitado"}),t.jsxs("span",{className:"text-[15px] font-black text-[#111]",children:["Kz ",parseFloat(m).toLocaleString("pt-AO")]})]}),t.jsxs("div",{className:"flex justify-between items-center text-[#00C853] bg-white rounded-xl p-3 shadow-sm border border-gray-50",children:[t.jsx("span",{className:"text-[11px] font-black uppercase tracking-wider",children:"Líquido"}),t.jsxs("span",{className:"text-[20px] font-black",children:["Kz ",(()=>{const e=parseFloat(m);return isNaN(e)?0:e-(()=>{const e=parseFloat(m);return isNaN(e)?0:.12*e})()})().toLocaleString("pt-AO")]})]})]}),t.jsxs("div",{className:"space-y-4 pt-2",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-[13px] font-bold text-[#111]",children:"Senha de Retirada"}),t.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-widest mt-0.5",children:"4 Dígitos Obrigatórios"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"bg-gray-50 rounded-2xl h-[50px] w-full flex items-center px-4 border border-gray-100 focus-within:border-[#00C853] transition-all",children:t.jsx("input",{type:"password",maxLength:4,value:h,onChange:e=>u(e.target.value.replace(/\D/g,"")),placeholder:"••••",className:"w-full bg-transparent text-center text-3xl tracking-[16px] font-black outline-none text-black placeholder:text-gray-300",autoFocus:!0})})})]}),t.jsx("button",{onClick:async()=>{try{await i(async()=>{const e=parseFloat(m),{error:t}=await s.rpc("request_withdrawal",{p_amount:e,p_pin:h});if(t)throw t;l?.("Retirada solicitada com sucesso!","success"),g(!1),u(""),p(""),w()},"Processando saque...")}catch(e){l?.(e.message||"Operação não sucedida.","error")}},disabled:h.length<4||f,className:"w-full h-[45px] rounded-2xl font-black text-[15px] transition-all flex items-center justify-center gap-2 shadow-xl "+(4===h.length?"bg-[#00C853] text-black shadow-green-500/10 active:scale-95":"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none"),children:f?t.jsx(r,{size:"w-5 h-5",color:"text-black"}):"Confirmar"})]})]})})]})};export{n as default};
