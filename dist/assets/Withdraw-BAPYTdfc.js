import{r as e,j as t}from"./react-vendor-0Am1niUb.js";import{u as a,s,S as r}from"./index-BonT0QVc.js";import"./supabase-BsxaddrC.js";import"./vendor-DtN75V_I.js";const n=({onNavigate:n,showToast:i})=>{const{withLoading:l}=a(),[c,o]=e.useState(0),[d,x]=e.useState(null),[p,m]=e.useState(""),[u,b]=e.useState(""),[h,g]=e.useState(!1),[f,j]=e.useState(!0);e.useEffect(()=>{w()},[]);const w=async()=>{try{const{data:{user:e}}=await s.auth.getUser();if(!e)return n("login");const{data:t}=await s.from("profiles").select("balance").eq("id",e.id).single();t&&o(t.balance||0);const{data:a}=await s.rpc("get_my_bank_accounts");a&&a.length>0&&x(a[0])}catch(e){}finally{j(!1)}};return f?t.jsx("div",{className:"flex justify-center items-center h-screen bg-white",children:t.jsx(r,{size:"w-8 h-8",color:"text-[#00C853]"})}):t.jsxs("div",{className:"bg-[#F4F7F6] min-h-screen font-display text-gray-900 pb-20 antialiased",children:[t.jsxs("div",{className:"bg-gradient-to-br from-[#0F1111] to-[#1A1C1C] pt-12 pb-24 px-6 rounded-b-[48px] shadow-2xl relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-[#00C853]/10 blur-[100px] rounded-full -translate-y-1/2 translate-x-1/2 overflow-hidden pointer-events-none"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-[#00C853]/5 blur-[80px] rounded-full translate-y-1/2 -translate-x-1/2 overflow-hidden pointer-events-none"}),t.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[t.jsx("button",{onClick:()=>n("home"),className:"size-11 flex items-center justify-center rounded-2xl bg-white/10 backdrop-blur-md text-white border border-white/10 active:scale-90 transition-all",children:t.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"arrow_back"})}),t.jsx("h1",{className:"text-white text-[18px] font-black tracking-tight",children:"Retirada"}),t.jsx("button",{onClick:()=>n("withdrawal-history"),className:"size-11 flex items-center justify-center rounded-2xl bg-white/10 backdrop-blur-md text-white border border-white/10 active:scale-90 transition-all",children:t.jsx("span",{className:"material-symbols-outlined text-[20px]",children:"history"})})]})]}),t.jsxs("main",{className:"px-6 -mt-16 relative z-10 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-[36px] p-8 shadow-premium border border-white/50 relative overflow-hidden",children:[t.jsx("div",{className:"absolute right-0 top-0 p-4 opacity-[0.03] pointer-events-none",children:t.jsx("span",{className:"material-symbols-outlined text-[120px]",children:"account_balance_wallet"})}),t.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2",children:"Saldo Disponível"}),t.jsxs("div",{className:"flex items-baseline gap-2",children:[t.jsx("span",{className:"text-[14px] font-black text-[#00C853] mb-2 uppercase tracking-tight",children:"KZs"}),t.jsx("span",{className:"text-[36px] font-black text-gray-900 tracking-tighter leading-none",children:c.toLocaleString("pt-AO",{minimumFractionDigits:2})})]})]}),t.jsxs("div",{className:"bg-white rounded-[32px] p-8 shadow-premium border border-white/50",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1",children:"Quantia do Saque"}),t.jsx("div",{className:"px-3 py-1 bg-gray-50 text-gray-400 text-[9px] font-black rounded-full border border-gray-100",children:"TX 12%"})]}),t.jsxs("div",{className:"flex items-center gap-4 border-b-2 border-gray-50 focus-within:border-[#00C853] transition-all pb-4",children:[t.jsx("span",{className:"text-[20px] font-black text-gray-400 tracking-tight",children:"KZs"}),t.jsx("input",{type:"number",value:p,onChange:e=>m(e.target.value),className:"bg-transparent flex-1 outline-none text-[32px] font-black text-gray-900 placeholder:text-gray-100 tracking-tighter",placeholder:"0,00"})]}),t.jsx("div",{className:"grid grid-cols-4 gap-2 mt-6",children:[2e3,5e3,1e4,2e4].map(e=>t.jsx("button",{onClick:()=>(e=>{m(e.toString())})(e),className:"py-3 bg-gray-50 rounded-xl text-[12px] font-black text-gray-900 hover:bg-gray-100 transition-all border border-transparent active:scale-95",children:e.toLocaleString("pt-AO")},e))})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest px-1",children:"Conta de Destino"}),d?t.jsxs("div",{onClick:()=>n("add-bank"),className:"bg-white rounded-[32px] p-6 shadow-premium border border-white/50 flex items-center gap-5 cursor-pointer hover:scale-[1.01] active:scale-[0.98] transition-all",children:[t.jsx("div",{className:"size-14 rounded-[20px] bg-[#EEFFF5] flex items-center justify-center text-[#00C853] shadow-inner",children:t.jsx("span",{className:"material-symbols-outlined text-[28px]",children:"account_balance"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-[16px] font-black text-gray-900 truncate tracking-tight",children:d.nome_banco}),t.jsx("p",{className:"text-[13px] text-gray-400 font-mono tracking-tighter mt-0.5",children:(e=>{if(!e)return"";const t=e.replace(/\s/g,"");return t.length<13?e:`${t.substring(0,8)}*****${t.substring(t.length-9)}`})(d.iban)})]}),t.jsx("div",{className:"size-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400",children:t.jsx("span",{className:"material-symbols-outlined text-[18px]",children:"edit"})})]}):t.jsxs("button",{onClick:()=>n("add-bank"),className:"w-full h-24 border-2 border-dashed border-gray-200 rounded-[32px] flex flex-col items-center justify-center gap-1 text-gray-400 hover:bg-white hover:border-[#00C853] hover:text-[#00C853] transition-all bg-gray-50/50",children:[t.jsx("span",{className:"material-symbols-outlined text-[24px]",children:"add_circle"}),t.jsx("span",{className:"text-[12px] font-black uppercase tracking-widest",children:"Vincular Conta"})]})]})]}),t.jsx("div",{className:"fixed bottom-0 inset-x-0 p-8 z-[100]",children:t.jsxs("button",{onClick:()=>{if(!d)return i?.("Você precisa vincular uma conta bancária.","warning"),void n("add-bank");const e=parseFloat(p);if(!p||isNaN(e)||e<=0)return void i?.("Digite um valor válido.","error");if(e<300)return void i?.("Valor mínimo de saque é 300 Kz.","warning");if(e>2e5)return void i?.("Valor máximo de saque é 200.000 Kz.","warning");if(e>c)return void i?.("Saldo insuficiente.","error");const t=new Date((new Date).toLocaleString("en-US",{timeZone:"Africa/Luanda"})).getHours();t<10||t>=16?i?.("O horário de retirada é das 10:00 às 16:00 (Fuso Angola).","warning"):g(!0)},className:"w-full h-[64px] bg-[#00C853] text-white font-black text-[15px] rounded-[24px] uppercase tracking-widest shadow-[0_16px_32px_-8px_rgba(0,200,83,0.5)] active:scale-[0.97] transition-all flex items-center justify-center gap-3 group",children:["Confirmar Saque",t.jsx("span",{className:"material-symbols-outlined text-[20px] group-hover:translate-x-1 transition-transform",children:"bolt"})]})}),h&&t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-end sm:items-center justify-center p-0 sm:p-6 animate-in fade-in duration-300",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-md",onClick:()=>!f&&g(!1)}),t.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-t-[48px] sm:rounded-[40px] p-8 pb-12 sm:pb-8 border border-white/50 shadow-2xl scale-100 animate-in slide-in-from-bottom-20 sm:slide-in-from-bottom-0 sm:zoom-in-95 duration-500",children:[t.jsx("div",{className:"w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-8 sm:hidden"}),t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"size-16 rounded-[24px] bg-[#EEFFF5] flex items-center justify-center mx-auto mb-5 shadow-inner",children:t.jsx("span",{className:"material-symbols-outlined text-[32px] text-[#00C853]",children:"verified_user"})}),t.jsx("h3",{className:"text-[22px] font-black text-gray-900 tracking-tight",children:"Segurança BP"}),t.jsx("p",{className:"text-gray-400 text-[14px] font-medium mt-1",children:"Digite sua senha de retirada de 4 dígitos."})]}),t.jsxs("div",{className:"bg-gray-50 rounded-[32px] p-6 mb-8 border border-gray-100/50",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-100",children:[t.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Transferência"}),t.jsxs("span",{className:"text-[15px] font-black text-gray-900",children:["Kz ",parseFloat(p).toLocaleString("pt-AO")]})]}),t.jsxs("div",{className:"flex justify-between items-center text-[#00C853]",children:[t.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Valor Líquido"}),t.jsxs("span",{className:"text-[22px] font-black tracking-tighter",children:["Kz ",(()=>{const e=parseFloat(p);return isNaN(e)?0:e-(()=>{const e=parseFloat(p);return isNaN(e)?0:.12*e})()})().toLocaleString("pt-AO")]})]})]}),t.jsx("div",{className:"flex justify-center mb-8",children:t.jsx("div",{className:"bg-white rounded-[24px] h-[72px] w-full flex items-center px-1 border-2 border-gray-100 focus-within:border-[#00C853] transition-all shadow-sm",children:t.jsx("input",{type:"password",maxLength:4,value:u,onChange:e=>b(e.target.value.replace(/\D/g,"")),placeholder:"••••",className:"w-full bg-transparent text-center text-[36px] tracking-[24px] pl-[12px] font-black outline-none text-gray-900 placeholder:text-gray-100",autoFocus:!0})})}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("button",{onClick:async()=>{try{await l(async()=>{const e=parseFloat(p),{error:t}=await s.rpc("request_withdrawal",{p_amount:e,p_pin:u});if(t)throw t;i?.("Retirada solicitada com sucesso!","success"),g(!1),b(""),m(""),w()},"Processando saque...")}catch(e){i?.(e.message||"Operação não sucedida.","error")}},disabled:u.length<4||f,className:"w-full h-[60px] rounded-[24px] font-black text-[15px] uppercase tracking-widest transition-all flex items-center justify-center gap-2 "+(4===u.length?"bg-gray-900 text-white shadow-2xl active:scale-[0.96]":"bg-gray-100 text-gray-300 cursor-not-allowed shadow-none"),children:f?t.jsx(r,{size:"w-6 h-6",color:"text-white"}):"Confirmar Saque"}),t.jsx("button",{disabled:f,onClick:()=>g(!1),className:"w-full h-[54px] bg-transparent text-gray-400 font-bold text-[13px] uppercase tracking-widest hover:text-gray-600 transition-all",children:"Cancelar"})]})]})]})]})};export{n as default};
