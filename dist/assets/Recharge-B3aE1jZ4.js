import{r as e,j as t}from"./react-vendor-C8-TlGsU.js";import{u as a,s,S as r}from"./index-BaS3q1EV.js";import"./pdf-utils-DX6aKe5X.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const n=[8500,12e3,25e3,35e3,95e3,12e4,3e5],i=({onNavigate:i,showToast:o})=>{const[l,c]=e.useState(""),[d,x]=e.useState(0),{withLoading:m}=a(),[p,h]=e.useState([]),[u,b]=e.useState(!0),[f,g]=e.useState(null),[j,v]=e.useState("BANK"),[N,y]=e.useState(0),[w,C]=e.useState("0.00");e.useEffect(()=>{"USDT"===j&&fetch("https://api.exchangerate-api.com/v4/latest/USD").then(e=>e.json()).then(e=>{e?.rates?.AOA&&y(e.rates.AOA)}).catch(e=>{})},[j]),e.useEffect(()=>{if("USDT"===j&&l&&N>0){const e=parseFloat(l);if(!isNaN(e)){C((e/N).toFixed(2))}}},[l,N,j]),e.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:e,error:t}=await s.from("bancos_empresa").select("*").eq("ativo",!0);if(!t&&e){const t=e.filter(e=>!e.nome_do_banco.toUpperCase().includes("USDT")&&!e.nome_do_banco.toUpperCase().includes("USTD"));h(t)}const{data:{user:a}}=await s.auth.getUser();if(a){const{data:e}=await s.from("profiles").select("balance").eq("id",a.id).single();e&&x(e.balance||0)}}catch(e){}finally{b(!1)}};return u?t.jsx("div",{className:"flex justify-center items-center h-screen bg-white",children:t.jsx(r,{size:"w-8 h-8",color:"text-[#00C853]"})}):t.jsxs("div",{className:"bg-white min-h-screen font-sans text-[#0F1111] pb-20 antialiased",children:[t.jsx("div",{className:"header-gradient-mixture pt-8 pb-20 px-4 relative",children:t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>i("home"),className:"size-10 flex items-center justify-center rounded-full bg-white/20 text-white active:scale-95 transition-all",children:t.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),t.jsx("h1",{className:"text-white text-lg font-bold tracking-tight",children:"Recarga"}),t.jsx("button",{onClick:()=>i("deposit-history"),className:"size-10 flex items-center justify-center rounded-full bg-white/20 text-white active:scale-95 transition-all",children:t.jsx("span",{className:"material-symbols-outlined",children:"history"})})]})}),t.jsxs("main",{className:"px-4 -mt-10 relative z-10 space-y-6",children:[t.jsxs("div",{className:"bg-white border border-gray-100 rounded-[28px] p-6 shadow-premium relative overflow-hidden",children:[t.jsx("div",{className:"absolute right-0 top-0 w-32 h-32 bg-[#00C853]/5 rounded-full blur-2xl -mr-16 -mt-16"}),t.jsx("p",{className:"text-[13px] font-bold text-[#0F1111] mb-4",children:"Valores Sugeridos"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(e=>{const a=l===e.toString();return t.jsx("button",{onClick:()=>c(e.toString()),className:"px-4 py-2.5 rounded-[2px] text-[13px] font-black transition-all active:scale-95 border "+(a?"bg-[#00C853] text-white border-[#00C853] shadow-lg shadow-[#00C853]/20":"bg-gray-50 text-[#0F1111] border-transparent hover:bg-[#00C853]/10 hover:text-[#00C853] hover:border-[#00C853]/20"),children:e.toLocaleString("pt-AO")},e)})})]}),t.jsxs("section",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("button",{onClick:()=>{v("BANK"),g(null)},className:"flex items-center gap-3 p-4 rounded-xl border transition-all "+("BANK"===j?"bg-[#00C853]/5 border-[#00C853]":"bg-gray-50 border-transparent"),children:[t.jsx("div",{className:"size-5 rounded-md border flex items-center justify-center transition-colors "+("BANK"===j?"bg-[#00C853] border-[#00C853]":"border-gray-300 bg-white"),children:"BANK"===j&&t.jsx("span",{className:"material-symbols-outlined text-white text-[16px] font-bold",children:"check"})}),t.jsx("div",{className:"flex flex-col items-start",children:t.jsx("span",{className:"text-[14px] font-bold "+("BANK"===j?"text-[#0F1111]":"text-gray-500"),children:"Bank (Kz)"})})]}),t.jsxs("button",{onClick:()=>{v("USDT"),g(null)},className:"flex items-center gap-3 p-4 rounded-xl border transition-all "+("USDT"===j?"bg-[#00C853]/5 border-[#00C853]":"bg-gray-50 border-transparent"),children:[t.jsx("div",{className:"size-5 rounded-md border flex items-center justify-center transition-colors "+("USDT"===j?"bg-[#00C853] border-[#00C853]":"border-gray-300 bg-white"),children:"USDT"===j&&t.jsx("span",{className:"material-symbols-outlined text-white text-[16px] font-bold",children:"check"})}),t.jsx("div",{className:"flex flex-col items-start",children:t.jsx("span",{className:"text-[14px] font-bold "+("USDT"===j?"text-[#0F1111]":"text-gray-500"),children:"USDT"})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[13px] font-bold text-[#0F1111]",children:"Valor da Recarga"}),t.jsxs("div",{className:"bg-gray-50 rounded-xl h-[50px] flex items-center px-4 gap-3 relative border border-transparent focus-within:border-[#00C853] transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"payments"}),t.jsx("input",{type:"number",value:l,onChange:e=>c(e.target.value),className:"bg-transparent flex-1 h-full outline-none text-[#111] font-medium placeholder:text-gray-400 text-[14px]",placeholder:"Digite o valor em Kz"}),t.jsx("span",{className:"text-[14px] font-bold text-gray-400",children:"Kz"})]}),"USDT"===j&&l&&t.jsxs("div",{className:"flex justify-between items-center px-2 animate-in fade-in slide-in-from-top-1",children:[t.jsx("span",{className:"text-[11px] text-gray-400 font-medium",children:"Conversão automática"}),t.jsxs("span",{className:"text-[13px] font-bold text-[#00C853]",children:["≈ ",w," USDT"]})]})]}),"BANK"===j&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-[13px] font-bold text-[#0F1111]",children:"Banco disponível"}),t.jsxs("div",{className:"bg-gray-50 rounded-xl h-[50px] flex items-center px-4 gap-3 relative border border-transparent focus-within:border-[#00C853] transition-colors",children:[t.jsx("span",{className:"material-symbols-outlined text-[#00C853] text-[24px]",children:"account_balance"}),t.jsxs("select",{value:f?.id||"",onChange:e=>{const t=p.find(t=>String(t.id)===e.target.value);g(t)},className:"bg-transparent flex-1 h-full outline-none text-[#111] font-medium appearance-none cursor-pointer text-[14px]",children:[t.jsx("option",{value:"",disabled:!0,children:"Escolha o banco"}),p.map(e=>t.jsx("option",{value:e.id,children:e.nome_do_banco},e.id))]}),t.jsx("span",{className:"material-symbols-outlined text-gray-400 text-[20px]",children:"expand_more"})]})]}),t.jsx("div",{className:"pt-4",children:t.jsx("button",{onClick:async()=>{const e=parseFloat(l);if(l&&!isNaN(e)){if("BANK"===j){if(e<8500)return void o?.("Recarga mínima via banco: 8.500 KZs","warning");if(e>1e6)return void o?.("Recarga máxima via banco: 1.000.000 KZs","warning");if(!f)return void o?.("Por favor, selecione um banco.","warning")}else{const e=parseFloat(w);if(e<4)return void o?.("Valor insuficiente. Mínimo aprox. 4 USDT","warning");if(e>1e4)return void o?.("Recarga máxima via USDT: 10.000 USDT","warning")}try{await m(async()=>{const{data:{user:t}}=await s.auth.getUser();if(!t)return o?.("Sessão expirada. Faça login novamente.","error"),void i("login");if("USDT"===j)return void i("deposit-usdt",{amountKz:e,amountUsdt:parseFloat(w),exchangeRate:N});const{data:a,error:r}=await s.rpc("create_deposit_request",{p_amount:e,p_bank_name:f.nome_do_banco,p_iban:f.iban});if(r)throw r;a.success&&i("confirmar-deposito",{deposit:{...a.data,nome_destinatario:f.nome_destinatario,nome_banco:f.nome_do_banco}})},"Gerando dados de recarga...")}catch(t){o?.(t.message||"Opah algo deu errado","error")}}else o?.("Digite um valor válido.","warning")},disabled:u||!l||"BANK"===j&&(!f||parseFloat(l)<3e3)||"USDT"===j&&parseFloat(w)<4,className:"w-full h-[45px] bg-[#00C853] text-white font-bold rounded-lg transition-all disabled:opacity-50 flex items-center justify-center",children:u?"Processando":"Confirmar"})})]})]})]})};export{i as default};
