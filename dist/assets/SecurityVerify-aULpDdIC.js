import{r as e,R as s,j as t}from"./react-vendor-0Am1niUb.js";import{s as a,S as r}from"./index-BonT0QVc.js";import"./supabase-BsxaddrC.js";import"./vendor-DtN75V_I.js";const l=({onNavigate:l,showToast:i})=>{const[n,o]=e.useState(null),[c,d]=e.useState(null),[x,m]=e.useState(null),[u,f]=e.useState(null),[h,p]=e.useState(!1),[g,b]=e.useState(null),[v,j]=e.useState(!0),[y,w]=e.useState(null),[N,k]=e.useState(10),[_,S]=e.useState(!1),[z,E]=e.useState(!0);s.useEffect(()=>{q();const e=e=>e.preventDefault(),s=()=>E(!document.hidden),t=()=>E(!1),a=()=>E(!0),r=e=>{("PrintScreen"===e.key||e.metaKey&&e.shiftKey&&("3"===e.key||"4"===e.key))&&(S(!0),i?.("Captura de tela detectada e bloqueada por segurança.","warning"))};return window.addEventListener("contextmenu",e),window.addEventListener("visibilitychange",s),window.addEventListener("blur",t),window.addEventListener("focus",a),window.addEventListener("keydown",r),()=>{window.removeEventListener("contextmenu",e),window.removeEventListener("visibilitychange",s),window.removeEventListener("blur",t),window.removeEventListener("focus",a),window.removeEventListener("keydown",r)}},[]),s.useEffect(()=>{let e;return y&&N>0?e=setInterval(()=>{k(e=>e-1)},1e3):0===N&&S(!0),()=>clearInterval(e)},[y,N]);const P=e=>{try{return atob(e.split("").reverse().join(""))}catch(s){return e}},q=async()=>{try{const{data:{user:e}}=await a.auth.getUser();if(!e)return;const{data:s,error:t}=await a.from("profiles").select("verified, bi_frente_url, bi_verso_url").eq("user_id",e.id).single();if(!t&&s&&s.verified){b(!0);const e=P(s.bi_frente_url).replace("documents/",""),t=P(s.bi_verso_url).replace("documents/",""),{data:r}=await a.storage.from("documents").createSignedUrl(e,60),{data:l}=await a.storage.from("documents").createSignedUrl(t,60);r?.signedUrl&&l?.signedUrl&&w({frente:r.signedUrl,verso:l.signedUrl})}}catch(e){}finally{j(!1)}},B=e=>btoa(e).split("").reverse().join(""),L=(e,s)=>{const t=e.target.files?.[0];if(t){if(t.size>5242880)return void i?.("O arquivo é muito grande. O máximo é 5MB.","warning");const e=new FileReader;e.onloadend=()=>{"frente"===s?(o(t),m(e.result)):(d(t),f(e.result))},e.readAsDataURL(t)}};return v?t.jsx("div",{className:"bg-background-dark min-h-screen flex items-center justify-center",children:t.jsx(r,{size:"w-10 h-10"})}):g?t.jsx("div",{className:"bg-background-dark font-display text-black antialiased min-h-screen flex flex-col items-center justify-center px-6 py-12",children:t.jsxs("div",{className:"flex flex-col items-center text-center gap-6 w-full max-w-sm",children:[t.jsx("div",{className:"size-20 rounded-full bg-primary/20 flex items-center justify-center border-4 border-primary/30",children:t.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"48px",fontWeight:"bold"},children:"verified_user"})}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("h1",{className:"text-2xl font-black text-black",children:"Conta Verificada"}),_?t.jsx("p",{className:"text-red-400 text-sm font-medium animate-pulse",children:"Por questões de segurança, o tempo de leitura terminou."}):t.jsxs("p",{className:"text-text-secondary text-sm font-medium",children:["Sua identidade foi confirmada. As imagens serão ocultadas em ",t.jsxs("span",{className:"text-primary font-bold",children:[N,"s"]}),"."]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 w-full",children:[t.jsxs("div",{className:"relative group",children:[t.jsx("p",{className:"text-left text-xs font-bold text-gray-500 mb-2 uppercase tracking-widest",children:"BI Frente"}),t.jsx("div",{className:"aspect-[1.6/1] rounded-2xl overflow-hidden border-2 border-gray-200 bg-surface-dark transition-all duration-700 "+(_?"blur-xl scale-95 opacity-50":""),children:y?.frente?t.jsx("img",{loading:"lazy",decoding:"async",src:y.frente,alt:"Frente",className:"w-full h-full object-cover contrast-[1.05] brightness-[1.02] saturate-[1.05]"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(r,{size:"w-6 h-6"})})})]}),t.jsxs("div",{className:"relative group",children:[t.jsx("p",{className:"text-left text-xs font-bold text-gray-500 mb-2 uppercase tracking-widest",children:"BI Verso"}),t.jsx("div",{className:"aspect-[1.6/1] rounded-2xl overflow-hidden border-2 border-gray-200 bg-surface-dark transition-all duration-700 "+(_?"blur-xl scale-95 opacity-50":""),children:y?.verso?t.jsx("img",{loading:"lazy",decoding:"async",src:y.verso,alt:"Verso",className:"w-full h-full object-cover contrast-[1.05] brightness-[1.02] saturate-[1.05]"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(r,{size:"w-6 h-6"})})})]})]}),t.jsx("button",{onClick:()=>l("profile"),className:"w-full mt-4 bg-primary hover:bg-green-400 text-white font-black text-lg py-4 rounded-2xl transition-all shadow-xl shadow-primary/20 active:scale-[0.98]",children:"Sair"})]})}):t.jsxs("div",{className:"bg-background-dark font-display text-black antialiased min-h-screen flex flex-col selection:bg-primary selection:text-black transition-all duration-500 "+(z?"":"blur-2xl opacity-50 scale-95 pointer-events-none"),style:{userSelect:"none",WebkitUserSelect:"none"},children:[!z&&t.jsxs("div",{className:"fixed inset-0 z-[999] bg-black/80 backdrop-blur-3xl flex flex-col items-center justify-center text-center p-6",children:[t.jsx("span",{className:"material-symbols-outlined text-primary text-6xl mb-4",children:"security"}),t.jsx("h2",{className:"text-xl font-bold text-black mb-2",children:"Página Protegida"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Por segurança, o conteúdo é ocultado quando você sai da página ou tenta capturá-lo."})]}),t.jsxs("div",{className:"relative flex h-full min-h-screen w-full flex-col overflow-x-hidden max-w-md mx-auto shadow-2xl",children:[t.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsx("button",{onClick:()=>l("profile"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:t.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),t.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Verificação"}),t.jsx("div",{className:"w-11"})]})}),t.jsxs("div",{className:"flex w-full flex-col items-center justify-center py-6",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"h-1.5 w-10 rounded-full bg-primary"}),t.jsx("div",{className:"h-1.5 w-10 rounded-full bg-primary"}),t.jsx("div",{className:"h-1.5 w-10 rounded-full bg-primary"})]}),t.jsx("p",{className:"text-xs font-bold text-gray-500 mt-3 uppercase tracking-widest",children:"Finalizando"})]}),t.jsxs("div",{className:"px-6 pb-8",children:[t.jsx("h1",{className:"text-[32px] font-extrabold leading-tight text-center pb-3",children:"Verifique sua identidade"}),t.jsx("p",{className:"text-base font-medium leading-relaxed text-center text-text-secondary",children:"Para garantir a segurança da sua conta, precisamos de uma foto nítida do seu Bilhete de Identidade (BI)."})]}),t.jsxs("div",{className:"flex flex-col gap-6 px-6 flex-1",children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("h3",{className:"text-lg font-bold leading-tight tracking-tight",children:"BI Frente"}),t.jsxs("label",{className:"group relative flex flex-col items-center justify-center w-full h-48 rounded-2xl border-2 border-dashed border-gray-700 bg-surface-dark/50 hover:bg-primary/5 hover:border-primary transition-all cursor-pointer overflow-hidden",children:[x?t.jsx("img",{loading:"lazy",decoding:"async",src:x,alt:"Preview",className:"w-full h-full object-cover contrast-[1.05] brightness-[1.02] saturate-[1.05]"}):t.jsxs("div",{className:"flex flex-col items-center gap-4 z-10",children:[t.jsx("div",{className:"h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:t.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"28px"},children:"add_a_photo"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-sm font-bold text-black",children:"Toque para carregar"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1.5 font-medium",children:"PNG, JPG ou PDF (max. 5MB)"})]})]}),t.jsx("input",{accept:"image/*",className:"hidden",type:"file",onChange:e=>L(e,"frente")})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("h3",{className:"text-lg font-bold leading-tight tracking-tight",children:"BI Verso"}),t.jsxs("label",{className:"group relative flex flex-col items-center justify-center w-full h-48 rounded-2xl border-2 border-dashed border-gray-700 bg-surface-dark/50 hover:bg-primary/5 hover:border-primary transition-all cursor-pointer overflow-hidden",children:[u?t.jsx("img",{loading:"lazy",decoding:"async",src:u,alt:"Preview",className:"w-full h-full object-cover contrast-[1.05] brightness-[1.02] saturate-[1.05]"}):t.jsxs("div",{className:"flex flex-col items-center gap-4 z-10",children:[t.jsx("div",{className:"h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",children:t.jsx("span",{className:"material-symbols-outlined text-primary",style:{fontSize:"28px"},children:"add_a_photo"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-sm font-bold text-black",children:"Toque para carregar"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1.5 font-medium",children:"PNG, JPG ou PDF (max. 5MB)"})]})]}),t.jsx("input",{accept:"image/*",className:"hidden",type:"file",onChange:e=>L(e,"verso")})]})]}),t.jsxs("div",{className:"flex items-start gap-4 p-5 bg-primary/10 rounded-2xl mt-2 border border-primary/10",children:[t.jsx("div",{className:"size-8 rounded-full bg-primary flex items-center justify-center shrink-0",children:t.jsx("span",{className:"material-symbols-outlined text-black",style:{fontSize:"18px",fontWeight:"bold"},children:"info"})}),t.jsx("p",{className:"text-sm text-text-secondary leading-relaxed font-medium",children:"Certifique-se de que todas as informações no seu BI estão legíveis e sem reflexos."})]}),t.jsx("div",{className:"h-12"})]}),t.jsxs("div",{className:"sticky bottom-0 w-full p-6 bg-background-dark/90 backdrop-blur-xl border-t border-gray-200",children:[t.jsx("button",{onClick:async()=>{if(n&&c){p(!0);try{const{data:{user:e}}=await a.auth.getUser();if(!e)return void i?.("Usuário não autenticado.","error");const s=e.id,t=`${s}/bi_frente_${Date.now()}`,{error:r}=await a.storage.from("documents").upload(t,n,{upsert:!0});if(r)throw r;const o=`${s}/bi_verso_${Date.now()}`,{error:d}=await a.storage.from("documents").upload(o,c,{upsert:!0});if(d)throw d;const x=B(`documents/${t}`),m=B(`documents/${o}`),{error:u}=await a.from("profiles").update({bi_frente_url:x,bi_verso_url:m,verified:!0}).eq("user_id",s);if(u)throw u;i?.("Documentos enviados e verificados com sucesso!","success"),b(!0),setTimeout(()=>l("profile"),2e3)}catch(e){i?.("Erro ao processar verificação: "+(e.message||"Erro desconhecido"),"error")}finally{p(!1)}}else i?.("Por favor, carregue as imagens da frente e do verso do seu BI.","warning")},disabled:h,className:"w-full flex items-center justify-center gap-3 bg-primary hover:bg-green-400 text-white font-black text-lg py-4 rounded-2xl transition-all shadow-xl shadow-primary/20 active:scale-[0.98] "+(h?"opacity-50 cursor-not-allowed":""),children:h?t.jsx(r,{size:"w-6 h-6",className:"text-black"}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"Enviar para Verificação"}),t.jsx("span",{className:"material-symbols-outlined font-bold",children:"arrow_forward"})]})}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-5 opacity-40",children:[t.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"lock"}),t.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.1em]",children:"Encriptação de ponta a ponta"})]})]})]})]})};export{l as default};
