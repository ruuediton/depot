const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-utils-DX6aKe5X.js","assets/vendor-D2WcXlqy.js","assets/react-vendor-C8-TlGsU.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./pdf-utils-DX6aKe5X.js";import{r as t,R as s,j as a}from"./react-vendor-C8-TlGsU.js";import{S as r,s as i}from"./index-BaS3q1EV.js";import"./vendor-D2WcXlqy.js";import"./supabase-DIRwJvxg.js";const n=({onNavigate:n,showToast:o})=>{const[l,c]=t.useState([]),[d,x]=t.useState(!0),[m,p]=t.useState({totalApplied:0,totalProfit:0});t.useEffect(()=>{(async()=>{x(!0);try{await Promise.all([u(),f()])}catch(e){}finally{x(!1)}})()},[]);const u=async()=>{try{await i.rpc("process_matured_investments")}catch(e){}},f=async()=>{try{const{data:{user:e}}=await i.auth.getUser();if(!e)return;const{data:t,error:s}=await i.from("usuario_fundos").select("*, fund:fundos(nome_fundo, taxa_retorno, url_imagem)").eq("id_usuario",e.id).order("data_inicio",{ascending:!1});if(s)throw s;const a=t||[];c(a);const r=a.reduce((e,t)=>e+Number(t.valor_aplicado),0),n=a.reduce((e,t)=>t.estado_ativo?e:e+(Number(t.retorno_calculado)-Number(t.valor_aplicado)),0);p({totalApplied:r,totalProfit:n})}catch(e){o&&o("Erro ao carregar seu histórico.","error")}},h=s.useCallback(e=>new Date(e).toLocaleDateString("pt-AO",{day:"2-digit",month:"short",year:"numeric"}),[]),g=s.useCallback(e=>{const[t,s]=e.toFixed(2).split(".");return{inteiro:t,centavos:s}},[]);return a.jsxs("div",{className:"bg-white min-h-screen text-[#0F1111] font-sans selection:bg-amber-100 pb-32",children:[a.jsx("header",{className:"header-gradient-mixture pb-16 pt-4 px-4",children:a.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[a.jsx("button",{onClick:()=>n("investimentos-fundo"),className:"w-11 h-11 flex items-center justify-center rounded-full bg-white/20 backdrop-blur-md transition-all active:scale-90",children:a.jsx("span",{className:"material-symbols-outlined text-white text-[28px]",children:"arrow_back"})}),a.jsx("h1",{className:"text-xl font-black text-white tracking-tight",children:"Meus Pedidos"}),a.jsx("div",{className:"w-11"})]})}),a.jsxs("main",{className:"max-w-md mx-auto",children:[a.jsx("div",{className:"p-6 bg-[#00C853] border-b border-[#00C853]",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-[11px] text-[#0F1111]/60 font-bold uppercase tracking-widest",children:"Total em Pedidos"}),a.jsxs("div",{className:"flex items-baseline gap-1",children:[a.jsx("span",{className:"text-xl font-bold",children:"Kz"}),a.jsx("h1",{className:"text-3xl font-black tracking-tighter",children:m.totalApplied.toLocaleString("pt-AO",{minimumFractionDigits:2})})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.jsxs("div",{className:"bg-white/30 px-2 py-0.5 rounded text-[11px] font-bold text-green-800",children:["Recompensas: +Kz ",m.totalProfit.toLocaleString("pt-AO")]}),a.jsxs("span",{className:"text-[11px] text-[#0F1111]/50 font-medium",children:[l.length," Pedidos"]})]})]})}),d?a.jsx("div",{className:"flex flex-col items-center justify-center py-40 gap-4",children:a.jsx(r,{size:"w-10 h-10",color:"text-[#00C853]"})}):a.jsx("div",{className:"flex flex-col divide-y divide-gray-100 px-2",children:l.length>0?l.map(t=>{const s=!t.estado_ativo,{inteiro:r,centavos:i}=g(Number(t.valor_aplicado));return a.jsxs("div",{className:"flex gap-4 p-4 items-start active:bg-gray-50 transition-colors bg-white rounded-xl my-1 border border-transparent",children:[a.jsxs("div",{className:"relative w-28 h-28 bg-gray-50 rounded-xl overflow-hidden shrink-0 flex items-center justify-center border border-gray-100",children:[t.fund?.url_imagem?a.jsx("img",{loading:"lazy",decoding:"async",src:t.fund.url_imagem,alt:t.fund.nome_fundo,className:"w-full h-full object-cover contrast-[1.05] brightness-[1.02] saturate-[1.05]"}):a.jsx("div",{className:"flex flex-col items-center",children:a.jsx("span",{className:"material-symbols-outlined text-3xl "+(s?"text-green-600":"text-[#00C853]"),children:s?"verified":"shopping_bag"})}),s&&a.jsx("div",{className:"absolute inset-0 bg-black/5 flex items-center justify-center",children:a.jsx("div",{className:"bg-[#007600] text-white text-[8px] font-black px-1.5 py-0.5 rounded uppercase",children:"Concluído"})})]}),a.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-1",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-tighter",children:["Data ",h(t.data_inicio)]}),t.estado_ativo&&a.jsx("span",{className:"text-[#e77600] font-black px-2 py-0.5 bg-amber-50 rounded text-[9px] uppercase tracking-tighter",children:"Processando"})]}),a.jsx("h3",{className:"text-[14px] font-black leading-tight line-clamp-1 text-[#0F1111] uppercase tracking-tighter mt-1",children:t.fund?.nome_fundo||"Produto BP"}),a.jsx("div",{className:"flex items-center gap-1.5",children:a.jsxs("span",{className:"text-[10px] text-gray-400 font-medium",children:["Pedido: #BP-",t.id_usuario_fundo.toString().slice(0,6)]})}),a.jsxs("div",{className:"flex items-baseline mt-1",children:[a.jsx("span",{className:"text-[13px] font-bold text-[#0F1111] mr-1",children:"Kz"}),a.jsx("span",{className:"text-[22px] font-black text-[#0F1111] leading-none",children:r}),a.jsx("span",{className:"text-[11px] font-bold text-[#0F1111] ml-0.5 uppercase",children:i})]}),a.jsxs("div",{className:"mt-2 p-2 rounded-lg bg-gray-50/50 border border-gray-100 flex flex-col gap-0.5",children:[a.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[a.jsx("span",{className:"text-gray-400 font-bold uppercase tracking-tighter",children:"Recompensa:"}),a.jsxs("span",{className:"text-green-700 font-black tracking-tighter",children:["Kz ",Number(t.retorno_calculado).toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between items-center text-[10px]",children:[a.jsx("span",{className:"text-gray-400 font-bold uppercase tracking-tighter",children:"Previsão:"}),a.jsx("span",{className:"text-[#0F1111] font-bold tracking-tighter",children:h(t.data_termino)})]})]}),s&&a.jsxs("button",{onClick:()=>(async t=>{try{const{jsPDF:s}=await e(async()=>{const{jsPDF:e}=await import("./pdf-utils-DX6aKe5X.js").then(e=>e.j);return{jsPDF:e}},__vite__mapDeps([0,1,2])),a=new s({orientation:"landscape",unit:"mm",format:"a5"});a.setFillColor(255,255,255),a.rect(0,0,210,148,"F"),a.setLineWidth(1),a.setDrawColor(255,216,20),a.rect(5,5,200,138),a.setFont("helvetica","bold"),a.setFontSize(22),a.setTextColor(15,17,17),a.text("COMPROVANTE DE PEDIDO",105,25,{align:"center"}),a.setFontSize(10),a.setTextColor(86,89,89),a.text("BP COMMERCE SERVICES",105,32,{align:"center"}),a.setDrawColor(230,230,230),a.line(40,38,170,38),a.setFontSize(12),a.setTextColor(86,89,89),a.text("Confirmação de pedido processado com sucesso.",105,50,{align:"center"}),a.setFillColor(243,243,243),a.roundedRect(40,60,130,50,3,3,"F"),a.setFontSize(14),a.setTextColor(15,17,17),a.text(t.fund?.nome_fundo||"Produto BP",105,75,{align:"center"}),a.setFontSize(30),a.setTextColor(0,118,0),a.text(`Kz ${Number(t.valor_aplicado).toLocaleString("pt-AO")}`,105,90,{align:"center"}),a.setFontSize(10),a.setTextColor(86,89,89),a.text(`Data: ${h(t.data_inicio)}`,105,102,{align:"center"}),a.setFontSize(8),a.text(`Pedido ID: ${t.id_usuario_fundo}`,105,130,{align:"center"}),a.save(`Recibo_BP_${t.id_usuario_fundo.slice(0,8)}.pdf`),o?.("Recibo gerado com sucesso!","success")}catch(s){o?.("Erro ao gerar recibo.","error")}})(t),className:"mt-3 py-2 bg-white border border-gray-200 rounded-lg text-[11px] font-bold text-[#0F1111] hover:bg-gray-50 transition-all flex items-center justify-center gap-2",children:[a.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"receipt"}),"Ver Recibo"]})]})]},t.id_usuario_fundo)}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center px-10",children:[a.jsx("span",{className:"material-symbols-outlined text-gray-200 text-6xl mb-4",children:"shopping_cart_off"}),a.jsx("h3",{className:"text-[#0F1111] font-bold text-lg mb-1",children:"Nenhum pedido"}),a.jsx("p",{className:"text-[#565959] text-sm mb-8",children:"Você ainda não realizou nenhum pedido no marketplace."}),a.jsx("button",{onClick:()=>n("investimentos-fundo"),className:"w-full py-3 bg-[#00C853] hover:bg-[#00C853] rounded-full font-medium text-[14px] border border-[#00C853]",children:"Ir para Loja"})]})})]})]})};export{n as default};
